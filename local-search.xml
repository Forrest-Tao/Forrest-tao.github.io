<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>newpage</title>
    <link href="/2023/11/20/newpage/"/>
    <url>/2023/11/20/newpage/</url>
    
    <content type="html"><![CDATA[<p><img src="/.com//blog\myhexo\source_posts\newpage\dog.JPG"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>demo</title>
    <link href="/2023/11/20/demo/"/>
    <url>/2023/11/20/demo/</url>
    
    <content type="html"><![CDATA[<p><img src="/.com//blog\myhexo\source\images\dog.JPG" alt="dog"></p><p><img src="/.com//blog\myhexo\source\images\dog.JPG"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>使用docker-compose搭建elk集群</title>
    <link href="/2023/11/19/%E4%BD%BF%E7%94%A8docker-compose%E6%90%AD%E5%BB%BAelk%E9%9B%86%E7%BE%A4/"/>
    <url>/2023/11/19/%E4%BD%BF%E7%94%A8docker-compose%E6%90%AD%E5%BB%BAelk%E9%9B%86%E7%BE%A4/</url>
    
    <content type="html"><![CDATA[<p>docker-compose file and detailed tutorial </p><p><a href="https://github.com/deviantony/docker-elk/tree/main#setting-up-user-authentication">ELK dokcer-compose  deviantony&#x2F;docker-elk: The Elastic stack (ELK) powered by Docker and Compose. (github.com)</a></p><p><a href="https://www.elastic.co/cn/downloads/past-releases/filebeat-8-11-0">Filebeat 8.11.0 | Elastic download</a></p><p>这里推荐ES 的 CSDN 官方博客 </p><p><a href="https://elasticstack.blog.csdn.net/?type=blog">Elastic 中国社区官方博客_Elastic,Elasticsearch,Kibana-CSDN博客</a></p><p>ELK 的工作流程</p><ol><li>Logstash用于收集、处理、转换多种来源的各种类型的数据，其中包括日志文件、消息队列、数据库、网络流量等。</li><li>Elasticsearch  它用于进行索引和存储</li><li>Kibana提供了一个用户友好的界面，用于搜索、分析、<strong>可视化</strong>这些数据</li></ol><p>修改完配置文件后使用一下命令来检测是否有语法错误</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">filebeat.exe <span class="hljs-built_in">test</span> config<br>filebeat.exe <span class="hljs-built_in">test</span> output<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">filebeat.exe -e<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>elk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>etcd实现服务注册与发现</title>
    <link href="/2023/11/19/etcd%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"/>
    <url>/2023/11/19/etcd%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="什么是服务发现"><a href="#什么是服务发现" class="headerlink" title="什么是服务发现"></a>什么是服务发现</h1><p>服务发现是一种在分布式系统中识别和定位可用服务的机制。在微服务架构中，系统被分割成多个小型服务，服务发现允许这些服务相互发现和通信。而etcd这个工具提供了一种集中管理和协调服务的方式，从而提高了分布式系统的灵活性、可扩展性和可靠性。</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50a6fc20d70d46be9794f7635dcb29c9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="服务注册与发现"></p><p>服务发现需要实现以下的基本功能</p><ul><li><strong>服务注册</strong>： 同一个service的所有节点注册到相同目录下，节点启动后，将自己的信息注册到所属的服务目录中</li><li><strong>健康检查</strong> ：服务节点定时进行健康检查，注册到服务目录中的信息设置一个较短的TTL，若连接失败，则节点不可用</li><li><strong>服务发现</strong>： 通过服务节点能查询到服务提供外部访问的 IP 和端口号。比如网关代理服务时能够及时的发现服务中新增节点、丢弃不可用的服务节点。</li></ul><h2 id="服务注册及健康检查"><a href="#服务注册及健康检查" class="headerlink" title="服务注册及健康检查"></a>服务注册及健康检查</h2><p>根据etcd的<code>v3 API</code>，当启动一个服务时候，我们把服务的地址写进etcd，注册服务。同时绑定租约（lease），并以续租约（keep leases alive）的方式检测服务是否正常运行，从而实现健康检查。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br><span class="hljs-string">&quot;go.etcd.io/etcd/clientv3&quot;</span><br>)<br><br><span class="hljs-comment">//ServiceRegister 创建租约注册服务</span><br><span class="hljs-keyword">type</span> ServiceRegister <span class="hljs-keyword">struct</span> &#123;<br>cli     *clientv3.Client <span class="hljs-comment">//etcd client</span><br>leaseID clientv3.LeaseID <span class="hljs-comment">//租约ID</span><br><span class="hljs-comment">//租约keepalieve相应chan</span><br>keepAliveChan &lt;-<span class="hljs-keyword">chan</span> *clientv3.LeaseKeepAliveResponse<br>key           <span class="hljs-type">string</span> <span class="hljs-comment">//key</span><br>val           <span class="hljs-type">string</span> <span class="hljs-comment">//value</span><br>&#125;<br><br><span class="hljs-comment">//NewServiceRegister 新建注册服务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServiceRegister</span><span class="hljs-params">(endpoints []<span class="hljs-type">string</span>, key, val <span class="hljs-type">string</span>, lease <span class="hljs-type">int64</span>)</span></span> (*ServiceRegister, <span class="hljs-type">error</span>) &#123;<br>cli, err := clientv3.New(clientv3.Config&#123;<br>Endpoints:   endpoints,<br>DialTimeout: <span class="hljs-number">5</span> * time.Second,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br>ser := &amp;ServiceRegister&#123;<br>cli: cli,<br>key: key,<br>val: val,<br>&#125;<br><br><span class="hljs-comment">//申请租约设置时间keepalive</span><br><span class="hljs-keyword">if</span> err := ser.putKeyWithLease(lease); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br><br><span class="hljs-keyword">return</span> ser, <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-comment">//设置租约</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ServiceRegister)</span></span> putKeyWithLease(lease <span class="hljs-type">int64</span>) <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">//设置租约时间</span><br>resp, err := s.cli.Grant(context.Background(), lease)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><span class="hljs-comment">//注册服务并绑定租约</span><br>_, err = s.cli.Put(context.Background(), s.key, s.val, clientv3.WithLease(resp.ID))<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><span class="hljs-comment">//设置续租 定期发送需求请求</span><br>leaseRespChan, err := s.cli.KeepAlive(context.Background(), resp.ID)<br><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br>s.leaseID = resp.ID<br>log.Println(s.leaseID)<br>s.keepAliveChan = leaseRespChan<br>log.Printf(<span class="hljs-string">&quot;Put key:%s  val:%s  success!&quot;</span>, s.key, s.val)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-comment">//ListenLeaseRespChan 监听 续租情况</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ServiceRegister)</span></span> ListenLeaseRespChan() &#123;<br><span class="hljs-keyword">for</span> leaseKeepResp := <span class="hljs-keyword">range</span> s.keepAliveChan &#123;<br>log.Println(<span class="hljs-string">&quot;续约成功&quot;</span>, leaseKeepResp)<br>&#125;<br>log.Println(<span class="hljs-string">&quot;关闭续租&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// Close 注销服务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ServiceRegister)</span></span> Close() <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">//撤销租约</span><br><span class="hljs-keyword">if</span> _, err := s.cli.Revoke(context.Background(), s.leaseID); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br>log.Println(<span class="hljs-string">&quot;撤销租约&quot;</span>)<br><span class="hljs-keyword">return</span> s.cli.Close()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> endpoints = []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;localhost:2379&quot;</span>&#125;<br>ser, err := NewServiceRegister(endpoints, <span class="hljs-string">&quot;/web/node1&quot;</span>, <span class="hljs-string">&quot;localhost:8000&quot;</span>, <span class="hljs-number">5</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalln(err)<br>&#125;<br><span class="hljs-comment">//监听续租相应chan</span><br><span class="hljs-keyword">go</span> ser.ListenLeaseRespChan()<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-comment">// case &lt;-time.After(20 * time.Second):</span><br><span class="hljs-comment">// ser.Close()</span><br>&#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h2 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h2><p>根据etcd的<code>v3 API</code>，很容易想到使用<code>Watch</code>监视某类服务，通过<code>Watch</code>感知服务的<code>添加</code>，<code>修改</code>或<code>删除</code>操作，修改服务列表。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br><span class="hljs-string">&quot;github.com/coreos/etcd/mvcc/mvccpb&quot;</span><br><span class="hljs-string">&quot;go.etcd.io/etcd/clientv3&quot;</span><br>)<br><br><span class="hljs-comment">// ServiceDiscovery 服务发现</span><br><span class="hljs-keyword">type</span> ServiceDiscovery <span class="hljs-keyword">struct</span> &#123;<br>cli        *clientv3.Client  <span class="hljs-comment">//etcd client</span><br>serverList <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-comment">//服务列表</span><br>lock       sync.Mutex<br>&#125;a<br><br><span class="hljs-comment">// NewServiceDiscovery  新建发现服务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServiceDiscovery</span><span class="hljs-params">(endpoints []<span class="hljs-type">string</span>)</span></span> *ServiceDiscovery &#123;<br>cli, err := clientv3.New(clientv3.Config&#123;<br>Endpoints:   endpoints,<br>DialTimeout: <span class="hljs-number">5</span> * time.Second,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br><span class="hljs-keyword">return</span> &amp;ServiceDiscovery&#123;<br>cli:        cli,<br>serverList: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>),<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// WatchService 初始化服务列表和监视</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ServiceDiscovery)</span></span> WatchService(prefix <span class="hljs-type">string</span>) <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">//根据前缀获取现有的key</span><br>resp, err := s.cli.Get(context.Background(), prefix, clientv3.WithPrefix())<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><br><span class="hljs-keyword">for</span> _, ev := <span class="hljs-keyword">range</span> resp.Kvs &#123;<br>s.SetServiceList(<span class="hljs-type">string</span>(ev.Key), <span class="hljs-type">string</span>(ev.Value))<br>&#125;<br><br><span class="hljs-comment">//监视前缀，修改变更的server</span><br><span class="hljs-keyword">go</span> s.watcher(prefix)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-comment">// watcher 监听前缀</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ServiceDiscovery)</span></span> watcher(prefix <span class="hljs-type">string</span>) &#123;<br>rch := s.cli.Watch(context.Background(), prefix, clientv3.WithPrefix())<br>log.Printf(<span class="hljs-string">&quot;watching prefix:%s now...&quot;</span>, prefix)<br><span class="hljs-keyword">for</span> wresp := <span class="hljs-keyword">range</span> rch &#123;<br><span class="hljs-keyword">for</span> _, ev := <span class="hljs-keyword">range</span> wresp.Events &#123;<br><span class="hljs-keyword">switch</span> ev.Type &#123;<br><span class="hljs-keyword">case</span> mvccpb.PUT: <span class="hljs-comment">//修改或者新增</span><br>s.SetServiceList(<span class="hljs-type">string</span>(ev.Kv.Key), <span class="hljs-type">string</span>(ev.Kv.Value))<br><span class="hljs-keyword">case</span> mvccpb.DELETE: <span class="hljs-comment">//删除</span><br>s.DelServiceList(<span class="hljs-type">string</span>(ev.Kv.Key))<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// SetServiceList 新增服务地址</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ServiceDiscovery)</span></span> SetServiceList(key, val <span class="hljs-type">string</span>) &#123;<br>s.lock.Lock()<br><span class="hljs-keyword">defer</span> s.lock.Unlock()<br>s.serverList[key] = <span class="hljs-type">string</span>(val)<br>log.Println(<span class="hljs-string">&quot;put key :&quot;</span>, key, <span class="hljs-string">&quot;val:&quot;</span>, val)<br>&#125;<br><br><span class="hljs-comment">// DelServiceList 删除服务地址</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ServiceDiscovery)</span></span> DelServiceList(key <span class="hljs-type">string</span>) &#123;<br>s.lock.Lock()<br><span class="hljs-keyword">defer</span> s.lock.Unlock()<br><span class="hljs-built_in">delete</span>(s.serverList, key)<br>log.Println(<span class="hljs-string">&quot;del key:&quot;</span>, key)<br>&#125;<br><br><span class="hljs-comment">// GetServices 获取服务地址</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ServiceDiscovery)</span></span> GetServices() []<span class="hljs-type">string</span> &#123;<br>s.lock.Lock()<br><span class="hljs-keyword">defer</span> s.lock.Unlock()<br>addrs := <span class="hljs-built_in">make</span>([]<span class="hljs-type">string</span>, <span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> s.serverList &#123;<br>addrs = <span class="hljs-built_in">append</span>(addrs, v)<br>&#125;<br><span class="hljs-keyword">return</span> addrs<br>&#125;<br><br><span class="hljs-comment">// Close 关闭服务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ServiceDiscovery)</span></span> Close() <span class="hljs-type">error</span> &#123;<br><span class="hljs-keyword">return</span> s.cli.Close()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> endpoints = []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;localhost:2379&quot;</span>&#125;<br>ser := NewServiceDiscovery(endpoints)<br><span class="hljs-keyword">defer</span> ser.Close()<br>ser.WatchService(<span class="hljs-string">&quot;/web/&quot;</span>)<br>ser.WatchService(<span class="hljs-string">&quot;/gRPC/&quot;</span>)<br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-time.Tick(<span class="hljs-number">10</span> * time.Second):<br>log.Println(ser.GetServices())<br>&#125;<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>etcd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>排序方法</title>
    <link href="/2023/11/19/%E6%8E%92%E5%BA%8F%E6%96%B9%E6%B3%95/"/>
    <url>/2023/11/19/%E6%8E%92%E5%BA%8F%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>influxDB的使用</title>
    <link href="/2023/11/18/influxDB%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/11/18/influxDB%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a href="https://www.influxdata.com/">InfluxDB</a>是一个开源分布式时序、事件和指标数据库。使用Go语言编写，无需外部依赖。其设计目标是实现分布式和水平伸缩扩展。</p><h2 id="win-使用docker-安装-influxDB"><a href="#win-使用docker-安装-influxDB" class="headerlink" title="win  使用docker 安装 influxDB"></a>win  使用docker 安装 influxDB</h2><p><a href="https://dl.influxdata.com/influxdb/releases/influxdb-1.7.7_windows_amd64.zip">https://dl.influxdata.com/influxdb/releases/influxdb-1.7.7_windows_amd64.zip</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull influxdb:latest<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>    --name influxdb \<br>    -p 8086:8086 \<br>    --volume /var/docker/influxdb2.0:/var/lib/influxdb2 \<br>    influxdb:latest<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span>  -it 9a78e3803fda /bin/bash<br></code></pre></td></tr></table></figure><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231118224557414.png" alt="image-20231118224557414"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231118213142006.png" alt="image-20231118213142006"> </p><p>token</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">7I2YKdt2QXHLeNu72LSkTp-MloUTTE5rhVDXL8gFmL95NO7C-5Ot4-bZon8PJwgrcsDamNWeIUOXPdVN90lwjA==<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">influx auth create -o org-name -all-access<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">O3TZy1oUlst_lzWhPbc4Fg9BNKb3HYNY_0g1S5E6liGghZTEpSgJgdKtQ2OHdXHtKl2_Uj4SVPc7OsL7t-x0Lg==<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">influx config <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p><a href="https://testerhome.com/column_channels/38060?order_by=like&">怎么部署性能监控平台，大佬指定一下 · TesterHome</a></p><p><a href="https://testerhome.com/topics/36405">Docker-Compose 轻松搭建 Grafana+InfluxDb 实用 Jmeter 监控面板 · TesterHome</a></p><p>查看配置</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br>influxdb2 <span class="hljs-string">&quot;github.com/influxdata/influxdb-client-go/v2&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// Create a new client using an InfluxDB server base URL and an authentication token</span><br>client := influxdb2.NewClient(<span class="hljs-string">&quot;http://localhost:8086&quot;</span>, <span class="hljs-string">&quot;Ki-3lIwR1A8WIJuXIa1od_nH2B164qs0i4_yS7H1mJ_NqiAs_6AIJ8ZUYAtT69eWvx9RIVSGFVtzZyPQ7DgdgA==&quot;</span>)<br><span class="hljs-comment">// Use blocking write client for writes to desired bucket</span><br>writeAPI := client.WriteAPIBlocking(<span class="hljs-string">&quot;initOrgName&quot;</span>, <span class="hljs-string">&quot;initBucketName&quot;</span>)<br><span class="hljs-comment">// Create point using full params constructor</span><br>p := influxdb2.NewPoint(<span class="hljs-string">&quot;stat&quot;</span>,<br><span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;unit&quot;</span>: <span class="hljs-string">&quot;temperature&quot;</span>&#125;,<br><span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;avg&quot;</span>: <span class="hljs-number">24.5</span>, <span class="hljs-string">&quot;max&quot;</span>: <span class="hljs-number">45.0</span>&#125;,<br>time.Now())<br><span class="hljs-comment">// write point immediately</span><br>writeAPI.WritePoint(context.Background(), p)<br><span class="hljs-comment">// Create point using fluent style</span><br>p = influxdb2.NewPointWithMeasurement(<span class="hljs-string">&quot;stat&quot;</span>).<br>AddTag(<span class="hljs-string">&quot;unit&quot;</span>, <span class="hljs-string">&quot;temperature&quot;</span>).<br>AddField(<span class="hljs-string">&quot;avg&quot;</span>, <span class="hljs-number">23.2</span>).<br>AddField(<span class="hljs-string">&quot;max&quot;</span>, <span class="hljs-number">45.0</span>).<br>SetTime(time.Now())<br>err := writeAPI.WritePoint(context.Background(), p)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-comment">// Or write directly line protocol</span><br>line := fmt.Sprintf(<span class="hljs-string">&quot;stat,unit=temperature avg=%f,max=%f&quot;</span>, <span class="hljs-number">23.5</span>, <span class="hljs-number">45.0</span>)<br>err = writeAPI.WriteRecord(context.Background(), line)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><br><span class="hljs-comment">// Get query client</span><br>queryAPI := client.QueryAPI(<span class="hljs-string">&quot;initOrgName&quot;</span>)<br><span class="hljs-comment">// Get parser flux query result</span><br>result, err := queryAPI.Query(context.Background(), <span class="hljs-string">`from(bucket:&quot;initBucketName&quot;)|&gt; range(start: -1h) |&gt; filter(fn: (r) =&gt; r._measurement == &quot;stat&quot;)`</span>)<br><span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// Use Next() to iterate over query result lines</span><br><span class="hljs-keyword">for</span> result.Next() &#123;<br><span class="hljs-comment">// Observe when there is new grouping key producing new table</span><br><span class="hljs-keyword">if</span> result.TableChanged() &#123;<br>fmt.Printf(<span class="hljs-string">&quot;table: %s\n&quot;</span>, result.TableMetadata().String())<br>&#125;<br><span class="hljs-comment">// read result</span><br>fmt.Printf(<span class="hljs-string">&quot;row: %s\n&quot;</span>, result.Record().String())<br>&#125;<br><span class="hljs-keyword">if</span> result.Err() != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;Query error: %s\n&quot;</span>, result.Err().Error())<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-comment">// Ensures background processes finishes</span><br><span class="hljs-keyword">defer</span> client.Close()<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="概念（总结自StackOverflow）"><a href="#概念（总结自StackOverflow）" class="headerlink" title="概念（总结自StackOverflow）"></a>概念（总结自StackOverflow）</h2><ul><li>A <strong>bucket</strong> is named location with retention policy where time-series data is stored.</li><li>A <strong>series</strong> is a logical grouping of data defined by shared measurement, tag and field.</li><li>A <strong>measurement</strong> is similar to an SQL <strong>database</strong> table.</li><li>A <strong>tag</strong> is similar to <strong>indexed columns</strong> in an SQL database.</li><li>A <strong>field</strong> is similar to <strong>unindexed columns</strong> in an SQL database.</li><li>A <strong>point</strong> is similar to SQL <strong>row</strong>.</li></ul><p>For example, a SQL table <code>workdone</code>:</p><table><thead><tr><th><strong><code>Email</code></strong></th><th><strong><code>Status</code></strong></th><th><strong><code>time</code></strong></th><th><strong><code>Completed</code></strong></th></tr></thead><tbody><tr><td><a href="mailto:&#108;&#x6f;&#x72;&#114;&#64;&#x69;&#110;&#x66;&#x6c;&#x75;&#120;&#x64;&#98;&#46;&#x63;&#111;&#x6d;">&#108;&#x6f;&#x72;&#114;&#64;&#x69;&#110;&#x66;&#x6c;&#x75;&#120;&#x64;&#98;&#46;&#x63;&#111;&#x6d;</a></td><td>start</td><td>1636775801000000000</td><td>76</td></tr><tr><td><a href="mailto:&#108;&#111;&#x72;&#x72;&#x40;&#x69;&#x6e;&#x66;&#108;&#x75;&#x78;&#100;&#x62;&#46;&#99;&#111;&#109;">&#108;&#111;&#x72;&#x72;&#x40;&#x69;&#x6e;&#x66;&#108;&#x75;&#x78;&#100;&#x62;&#46;&#99;&#111;&#109;</a></td><td>finish</td><td>1636775868000000000</td><td>120</td></tr><tr><td><a href="mailto:&#x6d;&#97;&#x72;&#x76;&#x40;&#105;&#110;&#x66;&#108;&#x75;&#x78;&#x64;&#x62;&#46;&#x63;&#111;&#x6d;">&#x6d;&#97;&#x72;&#x76;&#x40;&#105;&#110;&#x66;&#108;&#x75;&#x78;&#x64;&#x62;&#46;&#x63;&#111;&#x6d;</a></td><td>start</td><td>1636775801000000000</td><td>0</td></tr><tr><td><a href="mailto:&#x6d;&#x61;&#114;&#x76;&#x40;&#x69;&#x6e;&#x66;&#x6c;&#117;&#120;&#100;&#x62;&#46;&#x63;&#x6f;&#x6d;">&#x6d;&#x61;&#114;&#x76;&#x40;&#x69;&#x6e;&#x66;&#x6c;&#117;&#120;&#100;&#x62;&#46;&#x63;&#x6f;&#x6d;</a></td><td>finish</td><td>1636775868000000000</td><td>20</td></tr><tr><td><a href="mailto:&#99;&#x6c;&#x69;&#x66;&#x66;&#x40;&#105;&#x6e;&#102;&#108;&#x75;&#x78;&#100;&#x62;&#x2e;&#x63;&#111;&#x6d;">&#99;&#x6c;&#x69;&#x66;&#x66;&#x40;&#105;&#x6e;&#102;&#108;&#x75;&#x78;&#100;&#x62;&#x2e;&#x63;&#111;&#x6d;</a></td><td>start</td><td>1636775801000000000</td><td>54</td></tr><tr><td><a href="mailto:&#x63;&#x6c;&#x69;&#102;&#x66;&#64;&#105;&#x6e;&#102;&#x6c;&#x75;&#120;&#100;&#x62;&#46;&#99;&#111;&#109;">&#x63;&#x6c;&#x69;&#102;&#x66;&#64;&#105;&#x6e;&#102;&#x6c;&#x75;&#120;&#100;&#x62;&#46;&#99;&#111;&#109;</a></td><td>finish</td><td>1636775868000000000</td><td>56</td></tr></tbody></table><p>The columns <code>Email</code> and <code>Status</code> are indexed.</p><p>Hence:</p><ul><li>Measurement: <code>workdone</code></li><li>Tags: <code>Email</code>, <code>Status</code></li><li>Field: <code>Completed</code></li><li>Series (Cardinality &#x3D; 3 x 2 &#x3D; 6):<ol><li>Measurement: <code>workdone</code>; Tags: <code>Email</code>: <code>lorr@influxdb.com</code>, <code>Status</code>: <code>start</code>; Field: <code>Completed</code></li><li>Measurement: <code>workdone</code>; Tags: <code>Email</code>: <code>lorr@influxdb.com</code>, <code>Status</code>: <code>finish</code>; Field: <code>Completed</code></li><li>Measurement: <code>workdone</code>; Tags: <code>Email</code>: <code>marv@influxdb.com</code>, <code>Status</code>: <code>start</code>; Field: <code>Completed</code></li><li>Measurement: <code>workdone</code>; Tags: <code>Email</code>: <code>marv@influxdb.com</code>, <code>Status</code>: <code>finish</code>; Field: <code>Completed</code></li><li>Measurement: <code>workdone</code>; Tags: <code>Email</code>: <code>cliff@influxdb.com</code>, <code>Status</code>: <code>start</code>; Field: <code>Completed</code></li><li>Measurement: <code>workdone</code>; Tags: <code>Email</code>: <code>cliff@influxdb.com</code>, <code>Status</code>: <code>finish</code>; Field: <code>Completed</code></li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">.\influx.exe bucket list -o initOrgName -t Ki-3lIwR1A8WIJuXIa1od_nH2B164qs0i4_yS7H1mJ_NqiAs_6AIJ8ZUYAtT69eWvx9RIVSGFVtzZyPQ7DgdgA==<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">config create --config-name example-config-name --host-url https://us-west-2-1.aws.cloud2.influxdata.com --org example-org --token 3lIwR1A8WIJuXIa1od_nH2B164qs0i4_yS7H1mJ_NqiAs_6AIJ8ZUYAtT69eWvx9RIVSGFVtzZyPQ7DgdgA==<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>influxDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>索引总结</title>
    <link href="/2023/11/06/%E7%B4%A2%E5%BC%95%E6%80%BB%E7%BB%93/"/>
    <url>/2023/11/06/%E7%B4%A2%E5%BC%95%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h3 id="为什么mysql-的-innoDB-选择-使用-B-tree作为索引的数据结构"><a href="#为什么mysql-的-innoDB-选择-使用-B-tree作为索引的数据结构" class="headerlink" title="为什么mysql 的 innoDB 选择 使用 B+ tree作为索引的数据结构"></a>为什么mysql 的 innoDB 选择 使用 B+ tree作为索引的数据结构</h3><h4 id="B-tree-VS-B-tree"><a href="#B-tree-VS-B-tree" class="headerlink" title="B + tree VS B tree"></a>B + tree VS B tree</h4><ul><li>存储相同数量级别的情况下，B+ tree 的树高比B tree低，磁盘IO次数少</li><li>B+ tree叶子节点用双向链表串联起来，适合范围查询</li></ul><h4 id="B-tree-VS-Hash"><a href="#B-tree-VS-Hash" class="headerlink" title="B + tree VS Hash"></a>B + tree VS Hash</h4><ul><li>虽然hash的等值查询效率很高，但无法做到范围长查询</li><li>hash会有hash碰撞发生</li></ul><h3 id="什么时候适合使用索引"><a href="#什么时候适合使用索引" class="headerlink" title="什么时候适合使用索引"></a>什么时候适合使用索引</h3><ul><li>字段具有唯一性，比如商品的编码</li><li>常用于 Where 查询的字段</li><li>经常用于 <code>group by</code>和 <code>order by</code>的字段</li></ul><h3 id="什么时候不需要索引"><a href="#什么时候不需要索引" class="headerlink" title="什么时候不需要索引"></a>什么时候不需要索引</h3><ul><li>数据量少</li><li>索引字段常更新</li><li>字段中存在大量重复的数据</li><li><code>where</code> <code>order by</code>  <code> group by</code> 用不到的字段</li></ul><h3 id="什么时候索引会失效"><a href="#什么时候索引会失效" class="headerlink" title="什么时候索引会失效"></a>什么时候索引会失效</h3><ul><li>使用 左或者是左右模糊匹配的时候 <code>like %xxx</code> <code>like%xx%</code> </li><li>查询条件中存在计算、函数、类型转化操作</li><li>没能遵循最左匹配原则</li><li>在where字句中，如果 or 前的条件 是索引列，而在 or 之后为非索引列</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>八股</tag>
      
      <tag>索引</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>进程间的通信方式</title>
    <link href="/2023/11/06/%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/"/>
    <url>/2023/11/06/%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>进程间的通信方式有多种，可以按照，主机内部和主机与主机间的通信来划分。</p><ol><li><p>pipe</p></li><li><p>信号量</p></li><li><p>信号</p></li><li><p>消息队列</p></li><li><p>Socket</p></li><li><p>webSocket</p></li><li><p>RPC</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>八股</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysql中的事务</title>
    <link href="/2023/11/06/mysql%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8A%A1/"/>
    <url>/2023/11/06/mysql%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h3 id="事务的特性"><a href="#事务的特性" class="headerlink" title="事务的特性"></a>事务的特性</h3><p>ACID</p><ul><li><p>atomic</p></li><li><p>consistency</p></li><li><p>isolation</p></li><li><p>durability</p></li></ul><p>并发事务会引发什么问题</p><ul><li>脏读</li></ul><p>读到了另一个未提交事务修改过的数据</p><p><img src="https://cdn.xiaolincoding.com//mysql/other/10b513008ea35ee880c592a88adcb12f.png"></p><ul><li>不可重复读</li></ul><p>在一个事务中多次读取同一个数据，前后两次读取到的数据不一样的情况</p><p><img src="https://cdn.xiaolincoding.com//mysql/other/f5b4f8f0c0adcf044b34c1f300a95abf.png"></p><ul><li>幻读</li></ul><p>在一个事务中多次查询某个符合条件的记录数量，出现前后两次查询到的记录数量不一致</p><p><img src="https://cdn.xiaolincoding.com//mysql/other/d19a1019dc35dfe8cfe7fbff8cd97e31.png"></p>]]></content>
    
    
    
    <tags>
      
      <tag>mysql</tag>
      
      <tag>事务，八股</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hash函数</title>
    <link href="/2023/11/05/hash%E5%87%BD%E6%95%B0/"/>
    <url>/2023/11/05/hash%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>WIKIPEDIA</p><blockquote><p>A <strong>hash function</strong> is any <a href="https://en.wikipedia.org/wiki/Function_(mathematics)">function</a> that can be used to map <a href="https://en.wikipedia.org/wiki/Data_(computing)">data</a> of arbitrary size to fixed-size values, though there are some hash functions that support variable length output.[<a href="https://en.wikipedia.org/wiki/Hash_function#cite_note-1">1]</a> The values returned by a hash function are called <em>hash values</em>, <em>hash codes</em>, <em>digests</em>, or simply <em>hashes</em>. The values are usually used to index a fixed-size table called a <em><a href="https://en.wikipedia.org/wiki/Hash_table">hash table</a></em>. Use of a hash function to index a hash table is called <em>hashing</em> or <em>scatter storage addressing</em>.</p></blockquote><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ol><li>input可以是一个变长的字符串，output为一个固定长度的输出，该值称为散列值，长度固定</li><li>hash function的计算时间不应该过长</li><li>不可逆性</li><li>冲突性较低，抗碰撞性强</li><li>映射相对均匀</li></ol><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ul><li><p>错误验证，数据验证，完整性校验</p></li><li><p>数据加密，密码加盐</p></li><li><p>语音识别</p><blockquote><p>对于像从一个已知列表中匹配一个MP3文件这样的应用，一种可能的方案是使用传统的散列函数——例如<a href="https://zh.wikipedia.org/wiki/MD5">MD5</a>，但是这种方案会对时间平移、CD读取错误、不同的音频压缩算法或者音量调整的实现机制等情况非常敏感。使用一些类似于MD5的方法有利于迅速找到那些严格相同（从音频文件的二进制数据来看）的音频文件，但是要找到全部相同（从音频文件的内容来看）的音频文件就需要使用其他更高级的算法了。</p><p>那些并不紧随IT工业潮流的人往往能反其道而行之，对于那些微小差异足够健壮的散列函数确实存在。现存的绝大多数散列算法都是不够健壮的，但是有少数散列算法能够达到辨别从嘈杂房间里的扬声器里播放出来的音乐的健壮性。有一个实际的例子是<a href="https://zh.wikipedia.org/w/index.php?title=Shazam_Entertainment&action=edit&redlink=1">Shazam</a>[<a href="http://www.shazam.com/">1]</a> （<a href="https://web.archive.org/web/20080821140538/http://www.shazam.com/">页面存档备份</a>，存于<a href="https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E6%A1%A3%E6%A1%88%E9%A6%86">互联网档案馆</a>） 服务。用户可以用手机打开其app，并将话筒靠近用于播放音乐的扬声器。该项服务会分析正在播放的音乐，并将它于存储在数据库中的已知的散列值进行比较。用户就能够收到被识别的音乐的曲名。</p></blockquote></li></ul><h3 id="常见的hash-算法"><a href="#常见的hash-算法" class="headerlink" title="常见的hash 算法"></a>常见的hash 算法</h3><h4 id="SHA-2"><a href="#SHA-2" class="headerlink" title="SHA-2"></a>SHA-2</h4><p><strong>secure Hash Algorithm 2</strong> </p><p>先留一个坑位，慢慢看hash function</p><p>MD系列</p><p><strong>Message-Digest Algorithm</strong>  </p>]]></content>
    
    
    
    <tags>
      
      <tag>hash</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>各种锁</title>
    <link href="/2023/11/05/%E5%90%84%E7%A7%8D%E9%94%81/"/>
    <url>/2023/11/05/%E5%90%84%E7%A7%8D%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h2 id="各种锁🔒"><a href="#各种锁🔒" class="headerlink" title="各种锁🔒"></a>各种锁🔒</h2><p>当有多个线程同时访问共享资源时，该共享资源可能会数据错乱，此时，锁就有了作用。</p><p>加锁的目的是为了保证共享资源在任意时间里，只有一个线程访问，这样可以避免多线程导致共享数据错乱的问题。</p><h4 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h4><ul><li>当线程加锁成功后，该线程会占用该共享资源，直到该线程解锁，这期间其他线程无法访问该共享资源</li><li>当互斥锁加锁失败后，线程会释放CPU，把资源给其他线程，进入阻塞状态</li></ul><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost2/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E9%94%81/%E4%BA%92%E6%96%A5%E9%94%81%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png"></p><p>互斥锁加锁失败后，会从用户态陷入内核态，让内核来切换线程，这存在一定的<strong>性能开销</strong></p><ul><li>加锁失败，内核把线程的状态从【运行】-&gt;【阻塞】状态，把资源让给洽谈线程</li><li>当锁被释放后，该线程有机会拿到该锁。从【阻塞】状态转为【就绪】状态</li></ul><h4 id="自旋锁"><a href="#自旋锁" class="headerlink" title="自旋锁"></a>自旋锁</h4><p>自旋锁是通过 CPU 提供的 <code>CAS</code> 函数（<em>Compare And Swap</em>），在「用户态」完成加锁和解锁操作，不会主动产生线程上下文切换，所以相比互斥锁来说，会快一些，开销也小一些。</p><p>一般加锁的过程，包含两个步骤：</p><ul><li>第一步，查看锁的状态，如果锁是空闲的，则执行第二步；</li><li>第二步，将锁设置为当前线程持有；</li></ul><p>CAS 函数就把这两个步骤合并成一条硬件级指令，形成<strong>原子指令</strong>，这样就保证了这两个步骤是不可分割的，要么一次性执行完两个步骤，要么两个步骤都不执行。</p><p>比如，设锁为变量 lock，整数 0 表示锁是空闲状态，整数 pid 表示线程 ID，那么 CAS(lock, 0, pid) 就表示自旋锁的加锁操作，CAS(lock, pid, 0) 则表示解锁操作。</p><p>加锁失败后，一直忙等待，直到获取锁</p><p>自旋锁是最比较简单的一种锁，一直自旋，利用 CPU 周期，直到锁可用。<strong>需要注意，在单核 CPU 上，需要抢占式的调度器（即不断通过时钟中断一个线程，运行其他线程）。否则，自旋锁在单 CPU 上无法使用，因为一个自旋的线程永远不会放弃 CPU。</strong></p><h4 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h4><p>读写锁适用于能明确区分读操作和写操作的场景。</p><h4 id="乐观锁和悲观锁"><a href="#乐观锁和悲观锁" class="headerlink" title="乐观锁和悲观锁"></a>乐观锁和悲观锁</h4><p>悲观锁做事比较悲观，它认为<strong>多线程同时修改共享资源的概率比较高，于是很容易出现冲突，所以访问共享资源前，先要上锁</strong>。</p><p>乐观锁做事比较乐观，它假定冲突的概率很低，它的工作方式是：<strong>先修改完共享资源，再验证这段时间内有没有发生冲突，如果没有其他线程在修改资源，那么操作完成，如果发现有其他线程已经修改过这个资源，就放弃本次操作</strong>。</p><p>其中读写锁、互斥锁、自旋锁都是悲观锁</p><p>实际上，我们常见的git 也是用了乐观锁的思想，先让用户编辑代码，然后提交的时候，通过版本号来判断是否产生了冲突，发生了冲突的地方，需要我们自己修改后，再重新提交。</p><p>乐观锁虽然去除了加锁解锁的操作，但是一旦发生冲突，重试的成本非常高，所以<strong>只有在冲突概率非常低，且加锁成本非常高的场景时，才考虑使用乐观锁。</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>操作系统</tag>
      
      <tag>锁</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>两个nil可能不相等吗？</title>
    <link href="/2023/11/05/%E4%B8%A4%E4%B8%AAnil%E5%8F%AF%E8%83%BD%E4%B8%8D%E7%9B%B8%E7%AD%89%E5%90%97%EF%BC%9F/"/>
    <url>/2023/11/05/%E4%B8%A4%E4%B8%AAnil%E5%8F%AF%E8%83%BD%E4%B8%8D%E7%9B%B8%E7%AD%89%E5%90%97%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<h3 id="两个nil可能不相等吗？"><a href="#两个nil可能不相等吗？" class="headerlink" title="两个nil可能不相等吗？"></a>两个nil可能不相等吗？</h3><p>接口时对非接口之（例如指针，struct等）的封装，内部实现包含两个字段，类型<code>T</code>和值<code>V</code> 。一个接口为nil，当且仅当T和V都处于unset的状态（T&#x3D;nil，V is unset）</p><ul><li><p>两个接口比较时，会先比较T，再比较V</p></li><li><p>接口值和非接口值相比比较时，会将非接口值转为接口值，再比较</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-keyword">var</span> p *<span class="hljs-type">int</span> =<span class="hljs-literal">nil</span><br>    <span class="hljs-keyword">var</span> i <span class="hljs-keyword">interface</span>&#123;&#125; =p<span class="hljs-comment">//会将i转为 （type=*int，v=nil）</span><br>    fmt.Println(p==i)<span class="hljs-comment">//true</span><br>    fmt.Println(p==<span class="hljs-literal">nil</span>)<span class="hljs-comment">//true</span><br>    fmt.Println(i==<span class="hljs-literal">nil</span>)<span class="hljs-comment">//false</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><ol><li><code>fmt.Println(p==i)</code>  ,接口值与非接口值相比较时，会将i转为 （type&#x3D;* int，v&#x3D;nil）,此时p为（type&#x3D;*int，v&#x3D;nil），所以 p&#x3D;&#x3D;i ,返回true</li><li>p的V为nil，p&#x3D;&#x3D;nil，返回true</li><li>接口值与非接口值相比较时，会将非接口值转为接口值,再比较,(type&#x3D;* int,v&#x3D;nil)!&#x3D;(type&#x3D;nil,v&#x3D;nil),返回false</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>GO</tag>
      
      <tag>八股</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go的逃逸分析</title>
    <link href="/2023/11/05/Go%E7%9A%84%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90/"/>
    <url>/2023/11/05/Go%E7%9A%84%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h3 id="Go语言的局部变量是分配到栈上还是堆上？"><a href="#Go语言的局部变量是分配到栈上还是堆上？" class="headerlink" title="Go语言的局部变量是分配到栈上还是堆上？"></a>Go语言的局部变量是分配到栈上还是堆上？</h3><p>这由编译器决定。GO语言的编译器会决定分配到栈上还是堆上，编译器会做逃逸分析（escape analysis），当发现变量的作用域没有超出函数的范围，可以在栈上，反之必须在堆上。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> *<span class="hljs-type">int</span> &#123;<br>v := <span class="hljs-number">100</span><br><span class="hljs-keyword">return</span> &amp;v<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>m := foo()<br><span class="hljs-built_in">println</span>(*m)<br>&#125;<br></code></pre></td></tr></table></figure><p>foo函数中，如果v分配在栈上，foo函数返回时，&amp;v就会不存在，但这段程序是可以正常运行的。Go编译器会发现v的引用脱离了foo的作用域，会将其分配到堆上。</p>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>逃逸分析</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>读sync包</title>
    <link href="/2023/11/02/%E8%AF%BBsync%E5%8C%85/"/>
    <url>/2023/11/02/%E8%AF%BBsync%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h3 id="Sync-Cond"><a href="#Sync-Cond" class="headerlink" title="Sync.Cond"></a>Sync.Cond</h3><h3 id="Sync-Once"><a href="#Sync-Once" class="headerlink" title="Sync.Once"></a>Sync.Once</h3><h3 id="sync-Pool"><a href="#sync-Pool" class="headerlink" title="sync.Pool"></a>sync.Pool</h3>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>面试记录</title>
    <link href="/2023/10/30/%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/10/30/%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h3 id="格林深瞳-一面"><a href="#格林深瞳-一面" class="headerlink" title="格林深瞳 一面"></a>格林深瞳 一面</h3><p>一面时间：2023.11.1 </p><ul><li><p>用之前的笔试题开场，问我的处理逻辑，为什么这么想</p></li><li><p>通过第二道笔试题（报警响应），问了email的具体逻辑，有什么输出，有什么输入，还需要什么其他参数吗？</p></li><li><p>报警信息的来源</p></li><li><p>http的请求</p></li><li><p>http中 content type 有哪些 ?</p><ol><li><strong>text&#x2F;plain</strong>: 表示文本内容，通常是纯文本，不含任何格式化，如纯文本文件或普通文本消息。</li><li><strong>text&#x2F;html</strong>: 表示HTML文档，通常用于Web页面。</li><li><strong>text&#x2F;css</strong>: 表示Cascading Style Sheets（CSS）文件，用于定义文档的样式和布局。</li><li><strong>application&#x2F;json</strong>: 表示JSON（JavaScript Object Notation）数据，常用于数据交换。</li><li><strong>application&#x2F;xml</strong>: 表示XML（eXtensible Markup Language）数据，用于数据交换和配置文件等。</li><li><strong>application&#x2F;pdf</strong>: 表示Adobe PDF文档，通常用于电子文档的传输和显示。</li><li><strong>image&#x2F;jpeg</strong>: 表示JPEG图像，一种常见的图像格式。</li><li><strong>image&#x2F;png</strong>: 表示PNG图像，另一种常见的图像格式。</li><li><strong>image&#x2F;gif</strong>: 表示GIF图像，一种支持动画的图像格式。</li><li><strong>audio&#x2F;mpeg</strong>: 表示MPEG音频文件，如MP3音频文件。</li><li><strong>video&#x2F;mp4</strong>: 表示MP4视频文件，一种常见的视频格式。</li><li><strong>application&#x2F;octet-stream</strong>: 表示二进制数据，通常不指定特定的媒体类型。</li><li><strong>multipart&#x2F;form-data</strong>: 通常用于HTML表单文件上传，允许传输二进制文件数据。</li><li><strong>application&#x2F;x-www-form-urlencoded</strong>: 通常用于HTML表单提交，编码表单字段的键值对。</li></ol></li><li><p>http 中参数传递的方式</p><ol><li><strong>URL查询字符串（Query Parameters）</strong>：参数直接附加在URL的末尾，以问号（?）开头，不同参数之间使用“&amp;”符号分隔。例如：<code>https://example.com/page?param1=value1&amp;param2=value2</code>。</li><li><strong>表单（Form）</strong>：表单是HTML中的一种元素，可以包含各种输入字段（文本框、下拉列表、单选框等），用户可以在浏览器中填写表单字段，然后提交给服务器。这些字段的值通常以键值对的形式传递，可以使用不同的HTTP方法，如POST和GET，来提交表单数据。</li><li><strong>HTTP头部（HTTP Headers）</strong>：HTTP头部可以包含自定义的键值对，以传递一些元信息或参数。例如，可以在HTTP请求的头部中包含自定义的<code>X-My-Header: value</code>头部字段，服务器可以根据这些字段来处理请求。</li><li><strong>URL路径参数（Path Parameters）</strong>：有时，参数信息可以包含在URL的路径中，通过在路径中使用占位符来传递参数。例如，RESTful API通常使用这种方式，如<code>https://example.com/users/123</code>中的<code>123</code>是用户ID。</li><li><strong>请求正文（Request Body）</strong>：对于HTTP POST、PUT、PATCH等方法，数据可以包含在请求的正文中，通常以JSON、XML、或其他自定义格式进行编码。这种方式适用于传递复杂的数据结构，例如提交表单数据或上传文件。</li><li><strong>Cookie（HTTP Cookies）</strong>：Cookie 是一种在客户端和服务器之间传递数据的方式，通常用于跟踪用户的会话状态。服务器可以在HTTP响应中设置Cookie，然后浏览器会在后续请求中自动包含Cookie数据。</li><li><strong>会话（Session）</strong>：在某些情况下，参数可以存储在会话中，用户的会话状态在多个HTTP请求之间保持一致。</li><li><strong>URL重写（URL Rewriting）</strong>：在URL中将参数信息进行编码，通常使用URL路径的方式，以便将参数传递给服务器。</li></ol></li><li><p>开始笔试</p><ul><li>无缓冲的channel的读和写 （被卡脖子了~~，写了一个死锁，后来debug出来了）</li><li>有限容量队列的实现<ul><li>先是这么写 <code>arr:=arr[1:]</code>，发现arr的长度会变短</li><li>后来不敢偷懒了，共用了一块内存，过了</li></ul></li></ul><p></p></li><li><p>问项目</p><ul><li><code>特殊词过滤和防止循环转链</code>的具体逻辑</li><li>MD5的实现，hash是什么…</li><li>Snowflake 怎么实现，具体的参数有哪些<br>         1. 开始时间+机器ID构成node<br>             1. 使用来generate Int64的值</li><li>JWT 怎么使用的，具体的参数有哪些<ol><li>自定义的字段，如username，userID + standardClaims，构成了最终的Claims</li><li>其中StandardClaims 包括了expirationAt、Audience、ID、IssureAt、Subject、NotBefore</li></ol></li><li><code>随时间权重下降的算法评论系统</code> 的具体逻辑</li></ul></li><li><p>我开始反问</p><ul><li>有没有相应的ld，mt</li><li>面试会有几轮，会有HR面吗？</li><li><code>健康体育</code>的版块在公司中属于什么地位，开始研发多久了</li><li>公司的主要技术栈</li><li>可以讲讲我的面试表现吗</li></ul><p>我没了~~</p><p>2023.11.2 我收到了第一份感谢信，我被打回了人才库~~~</p></li></ul><h3 id="字节后端一面"><a href="#字节后端一面" class="headerlink" title="字节后端一面"></a>字节后端一面</h3><p>​    面试时间：2023.11.7 </p><p>​    2023.11.14，也就是7天后我开始反思自己，调整心态，一方面项目自己没能把握机会，另一方面自己的简历有夸大的部分，面试官基本围绕你的项目和简历来进行提问。</p><p>总结：</p><ul><li>主动，你要主动把自己的知识面和特性展现出来，不要等面试官来找你的优点，你要牵引面试官跟着你的思路走，而不是他牵着你的鼻子走</li></ul><ol start="2"><li>自己不是很熟练的东西就不要往简历中写，面试官的问题思路来源大部分都是来自你的项目和个人介绍的技术栈中</li></ol><h3 id="字节AI编辑实习生"><a href="#字节AI编辑实习生" class="headerlink" title="字节AI编辑实习生"></a>字节AI编辑实习生</h3><p>2023.11.13 </p><h4 id="总结转链项目："><a href="#总结转链项目：" class="headerlink" title="总结转链项目："></a>总结转链项目：</h4><h5 id="Convert"><a href="#Convert" class="headerlink" title="Convert"></a>Convert</h5><pre><code class="hljs"> 1. 校验数据 - 数据不为空 - 链接可访问 - 不是之前已经转过的长链接（用MD5计算长链接的值，去数据库中查询） - 不是数据库中存在的短链接 2. 取号 - 号码转链接 - 查看是否为blackList 3. 存入bloom filter 4. 存储长短连接的对应关系 5. 返回响应</code></pre><p>​    </p><h5 id="Show"><a href="#Show" class="headerlink" title="Show"></a>Show</h5><ol><li>查询布隆过滤器 （若短链接不存在，访问失败）</li><li>用go-zero 查询短链接和长链接的对应关系</li><li>返回响应</li></ol><p>http中的常见字段：</p><ul><li>connection</li><li>content-type </li><li>content-length</li><li>host</li><li>content-encoding</li></ul><p>get 和 post的区别</p><ul><li>幂等</li><li>数据传送方式</li><li>语义</li><li>数据长度</li><li>缓存</li><li>安全性</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>MongoDB的使用</title>
    <link href="/2023/10/26/MongoDB%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/10/26/MongoDB%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="安装MongoDB"><a href="#安装MongoDB" class="headerlink" title="安装MongoDB"></a>安装MongoDB</h3><ul><li>拉取最新镜像</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker pull mongo:latest<br></code></pre></td></tr></table></figure><ul><li>查看本地镜像</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker images<br></code></pre></td></tr></table></figure><ul><li>运行容器</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker run -itd --name mongo -p 27017:27017 mongo --auth<br></code></pre></td></tr></table></figure><p>​参数说明 ：</p><ol><li><strong>p 27017:27017</strong> ：映射容器服务的 27017 端口到宿主机的 27017 端口。外部可以直接通过 宿主机 ip:27017 访问到 mongo 的服务。</li></ol><p>​2. <strong>–auth</strong>：需要密码才能访问容器服务。</p><ul><li><p>添加用户和设置密码</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker <span class="hljs-built_in">exec</span> -it mongo mongosh admin<br><span class="hljs-comment"># 创建一个名为 admin，密码为 123456 的用户。</span><br>&gt;  db.createUser(&#123; user:<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-built_in">pwd</span>:<span class="hljs-string">&#x27;123456&#x27;</span>,roles:[ &#123; role:<span class="hljs-string">&#x27;userAdminAnyDatabase&#x27;</span>, db: <span class="hljs-string">&#x27;admin&#x27;</span>&#125;,<span class="hljs-string">&quot;readWriteAnyDatabase&quot;</span>]&#125;);<br><span class="hljs-comment"># 尝试使用上面创建的用户信息进行连接。</span><br>&gt; db.auth(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;123456&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>连接到 MongoDB 容器</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it mongo bash<br></code></pre></td></tr></table></figure><p>使用MongoShell</p>]]></content>
    
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux命令行积累</title>
    <link href="/2023/10/26/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%A7%AF%E7%B4%AF/"/>
    <url>/2023/10/26/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%A7%AF%E7%B4%AF/</url>
    
    <content type="html"><![CDATA[<p> <strong>移动光标</strong></p><table><thead><tr><th align="center">按键</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">ctrl-a</td><td align="center">移动光标到行首</td></tr><tr><td align="center">ctrl-e</td><td align="center">移动光标到行尾</td></tr><tr><td align="center">ctrl-f</td><td align="center">-&gt;</td></tr><tr><td align="center">ctrl-b</td><td align="center">&lt;-</td></tr></tbody></table><p><strong>修改文本</strong></p><table><thead><tr><th align="center">按键</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">ctrl-d</td><td align="center">删除光标位置的字符</td></tr><tr><td align="center">ctrl-t</td><td align="center">光标前元素与当前光标位置的字符互换位置</td></tr><tr><td align="center">Alt-u</td><td align="center">把光标位置到字尾的字符转为大写字母</td></tr><tr><td align="center">Alt-l</td><td align="center">把光标位置到字尾的字符转为小写字母</td></tr><tr><td align="center">Alt-t</td><td align="center">把光标位置的字 和 其前方的字位置互换</td></tr></tbody></table><p><strong>剪切和粘贴</strong></p><table><thead><tr><th align="center">按键</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">ctrl-k</td><td align="center">剪切从光标位置到行尾的文本</td></tr><tr><td align="center">ctrl-u</td><td align="center">剪切从光标到行首的文本</td></tr><tr><td align="center">Alt-d</td><td align="center">剪切从光标位置到词尾的文本</td></tr><tr><td align="center">Ctrl-y</td><td align="center">将剪切的文本粘贴到光标位置</td></tr></tbody></table>]]></content>
    
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>makefile Tutorial</title>
    <link href="/2023/10/25/Tutorial/"/>
    <url>/2023/10/25/Tutorial/</url>
    
    <content type="html"><![CDATA[<p>Makefile是一种用于构建和编译项目的工具，通常用于C&#x2F;C++项目，但也可以用于其他编程语言。Makefile使用一种特定的语法来定义项目中的规则和依赖关系。以下是Makefile的基本语法要点：</p><ol><li><p><strong>目标（Targets）</strong>：目标是您要构建的文件或任务的名称。通常，第一个目标是默认目标，可以通过运行<code>make</code>命令来构建。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">target: dependencies</span><br>    command<br></code></pre></td></tr></table></figure><ul><li><code>target</code>是目标的名称。</li><li><code>dependencies</code>是目标的依赖项，可以是其他目标或文件。</li><li><code>command</code>是构建目标的命令。</li></ul></li><li><p><strong>规则（Rules）</strong>：规则定义了如何构建目标以及它的依赖项。规则通常出现在Makefile中。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">target: dependencies</span><br>    command<br></code></pre></td></tr></table></figure><p>例如：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">build: main.go </span><br>go build -o bin/main main.go<br></code></pre></td></tr></table></figure></li><li><p><strong>变量（Variables）</strong>：您可以在Makefile中定义变量，以便更轻松地重用值。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile">BINARY = <span class="hljs-string">&quot;BINARYFileName&quot;</span><br><br><span class="hljs-section">build: main.go</span><br>    go build -o bin/$&#123;BINARY&#125; main.go<br></code></pre></td></tr></table></figure></li><li><p><strong>条件语句（Conditionals）</strong>：Makefile支持条件语句，您可以根据条件执行不同的命令。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs makefile">BINARY = <span class="hljs-string">&quot;BINARYFileName&quot;</span><br><br><span class="hljs-section">clean:</span><br>@if [ -f $&#123;BINARY&#125; ]; then<br>    rm $&#123;BINARY&#125;<br>fi<br></code></pre></td></tr></table></figure></li><li><p><strong>伪目标（Phony Targets）</strong>：伪目标不代表实际的文件，而是表示特定任务。它们通常用于指定清理（<code>clean</code>）或其他非文件生成任务。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-meta"><span class="hljs-keyword">.PHONY</span>: clean</span><br><span class="hljs-section">clean:</span><br>    rm -f my_program<br></code></pre></td></tr></table></figure></li></ol><p><strong>案例</strong></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># 声明变量</span><br>BINARY=<span class="hljs-string">&quot;BIANRYFileName&quot;</span><br><span class="hljs-comment"># 使用make指令时，执行all中的所用target</span><br><span class="hljs-section">all: goTool build</span><br><br><span class="hljs-section">goTool:</span><br>go fmt ./<br>go vet ./<br><br><span class="hljs-section">build:</span><br>CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o ./bin/$&#123;BIANRYFileName&#125;<br><span class="hljs-comment">#go build -o bin/main main.go</span><br><br><span class="hljs-section">run:</span><br>go run main.go<br><br><span class="hljs-section">clean:</span><br>@if [ -f $&#123;BINARY&#125; ]; then<br>    rm $&#123;BINARY&#125;<br>fi<br><br><span class="hljs-section">compile:</span><br>echo <span class="hljs-string">&quot;Compiling for every OS and platform&quot;</span><br><span class="hljs-comment">#GOOS=freebsd GOARCH=386 go build -o bin/main-freebsd-386 main.go</span><br>GOOS=linux GOARCH=386 go build -o bin/main-linux-386 main.go<br><span class="hljs-comment">#GOOS=windows GOARCH=386 go build -o bin/main-windows-386 main.go</span><br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Makefile</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【读Go专家编程】之Context篇</title>
    <link href="/2023/10/20/%E3%80%90%E8%AF%BBGo%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%91%E4%B9%8BContext%E7%AF%87/"/>
    <url>/2023/10/20/%E3%80%90%E8%AF%BBGo%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%91%E4%B9%8BContext%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<p>Context的注意事项</p><ul><li>不要把Context放在结构体中，要以参数的方式显示传递</li><li>以Context作为参数传递的函数方法，应该发Context作为第一个参数</li><li>给一个函数方法传递Context的时候，不要传递nil，如果不知道要传递什么，可以传递 contex.TODO（）</li><li>context 的Value相关方法应该传递爱请求域的必要参数，不应该用于传递可选参数</li><li>Context是线程安全的，可以放心的在goroutine中传递</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>git总结</title>
    <link href="/2023/10/20/git%E6%80%BB%E7%BB%93/"/>
    <url>/2023/10/20/git%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h3 id="使用-git-commit-来提交文件"><a href="#使用-git-commit-来提交文件" class="headerlink" title="使用 git commit 来提交文件"></a>使用 git commit 来提交文件</h3><p>git commit -am  “first commit “</p><h3 id="使用git-reset-回退版本"><a href="#使用git-reset-回退版本" class="headerlink" title="使用git reset 回退版本"></a>使用git reset 回退版本</h3><p>git reset 有三个版本 –soft –hard –mixed </p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020090358533.png" alt="image-20231020090358533"></p><p>git ls-files 查看暂存区中的内容</p><p>假如有误操作，可以使用一下命令，进行回溯</p><p><strong>git reflog 查看历史版本号</strong></p><p>git reset –hard 版本号</p><h3 id="使用-git-diff-查看差异"><a href="#使用-git-diff-查看差异" class="headerlink" title="使用 git diff 查看差异"></a>使用 git diff 查看差异</h3><ul><li>git diff 默认查看working Directory 和 Stage Area 的差异</li><li>git diff –cached&#x2F;staged 查看 Stage Area 和 Local Area的差异</li><li>git diff  HEAD查看 working Directory 和 Local Area的差异</li><li>git diff 【版本号1】 【版本号2】 查看两个版本之间的差异<ul><li>HEAD 表示当前版本</li><li>HEAD~ 表示上一个版本</li><li>HEAD~2 表示上一个版本</li><li>git diff HEAD~2 HEAD file.txt 查看 file.txt 当前版本和上两个版本间的差异</li></ul></li></ul><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020080808149.png" alt="image-20231020080808149"></p><h3 id="使用-git-rm-来删除文件"><a href="#使用-git-rm-来删除文件" class="headerlink" title="使用 git rm 来删除文件"></a>使用 git rm 来删除文件</h3><p>用 <code>git rm fileName</code> <strong>取代</strong> <code>rm fileName + git add fileName</code></p><p>git rm fileName 会删除 本地文件 和 版本库文件</p><p>git rm –cached 只会删除 版本库文件</p><h3 id="使用-gitignore忽视文件"><a href="#使用-gitignore忽视文件" class="headerlink" title="使用.gitignore忽视文件"></a>使用.gitignore忽视文件</h3><p>.gitignore 有一个奏效前提，文件不能是已经被提交到版本库中的文件</p><ul><li>将需要忽视的文件加入 .gitignore 中</li><li>可以使用 通配符 <code>*</code> 来适配所有文件</li><li>可以将需要忽略的文件夹放入 .gitignore 中，文件夹以<code>/</code> 结尾  <code>eg: temp/</code>，这将忽视temp文件夹下的所有文件。 <strong>注意</strong>：需要忽视的文件夹不能为空，如果为空，gitignore不会生效</li></ul><h4 id="gitignore的匹配规则"><a href="#gitignore的匹配规则" class="headerlink" title="gitignore的匹配规则"></a>gitignore的匹配规则</h4><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020103715140.png" alt="image-20231020103715140"></p><h3 id="本地仓库与远程仓库关联"><a href="#本地仓库与远程仓库关联" class="headerlink" title="本地仓库与远程仓库关联"></a>本地仓库与远程仓库关联</h3><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020215250344.png" alt="image-20231020215250344"></p><p>添加远程仓库  </p><p>git remote add &lt;远程仓库别名&gt;  &lt;远程仓库地址&gt;  其中 github默认分支名字为 origin（远程仓库别名） </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote add origin git@github.com:Forrest-Tao/gitTest.git<br></code></pre></td></tr></table></figure><p>将本地文件推送到远程仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push -u &lt;remote&gt; &lt;remote&gt;<br>git push origin main<br></code></pre></td></tr></table></figure><p>其中：</p><ul><li><code>&lt;remote&gt;</code> 是指定远程仓库的名称，通常是 <code>origin</code>，但也可以是其他已配置的远程仓库的名称。</li><li><code>&lt;remote&gt;</code> 是指定要推送的本地分支的名称。</li></ul><p>拉取远程仓库内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git pull &lt;远程仓库名&gt; &lt;远程分支名&gt; :&lt;本地分支名&gt;<br></code></pre></td></tr></table></figure><h3 id="git-branch"><a href="#git-branch" class="headerlink" title="git branch"></a>git branch</h3><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020224632232.png" alt="image-20231020224632232"></p><ul><li><p>git branch 查看分支，其中用  *  表示的为当前分支</p></li><li><p>git branch brachName 新建分支</p></li><li><p>git checkout branchName 用来切换到相应的分支</p><ul><li>由于 git checkout 有双重含义（恢复文件到相应的状态 | 切换分支，在git的2.23中我们可以使用语义更加明确的 switch）</li><li>推荐使用 <code>git switch branchName</code></li></ul></li><li><p>如果一个分支不再需要，我们可以使用 git  brach -d 来删除分支</p></li></ul><p>使用 git merge 将不同的分支内容进行合并</p><p>可以使用 <code>git  log --graph --oneline --decorate --all</code> 来查看合并分支详情</p><h3 id="解决合并冲突"><a href="#解决合并冲突" class="headerlink" title="解决合并冲突"></a>解决合并冲突</h3><ul><li>当两个分支 没有冲突时，git merge branchName 会非常丝滑的完成，将branchName 中的文件和当前分支的文件进行合并；并且会自动提交</li><li>当两个分支发生冲突时，git merger branchName 会提示我们自动合并发生错误，需要我们手动合并；此时会将branchName中的数据写入当前发生冲突的文件的那个位置，并且显示的提示什么什么是当前分支的内容，而什么什么是branchName的内容，我们需要手动将冲突解决；并由我们手动 git add 和 git commit</li></ul><h3 id="Rebase"><a href="#Rebase" class="headerlink" title="Rebase"></a>Rebase</h3><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021101119181.png" alt="image-20231021101119181"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021091150448.png" alt="image-20231021091150448"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021091243478.png" alt="image-20231021091243478"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021103001369.png" alt="image-20231021103001369"></p><p>使用 alias 来代替  git log –oneline –all –graph</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">alias</span> graph=<span class="hljs-string">&quot; git log --oneline --all --graph&quot;</span><br></code></pre></td></tr></table></figure><h3 id="分支管理和工作流模型"><a href="#分支管理和工作流模型" class="headerlink" title="分支管理和工作流模型"></a>分支管理和工作流模型</h3><p><img src="C:\Users\Forrest\OneDrive\桌面\image-20231021104124209.png" alt="image-20231021104124209"></p><ul><li><code>master/main</code> 代表项目的稳定版本，每个提交到主分支的代码都应该是经过测试和审核的</li><li><code>dev</code> 用于日常开发。所有的功能分支、发布分支、修改分支都应该从开发分支派生。</li><li><code>feat</code> 用于开发单独的功能或特性。 每个功能分支都应该从开发分支派生，并在开发完成后合并回 <strong>dev</strong></li><li><code>relaese</code> 用于准备项目发布。发布分支应该从开发分支派生，并在准备好发布版本后合并回主分支和开发分支</li><li><code>hotfix</code> 用于修改主分支上的紧急问题。热修复分支应该从主分支派生，并在修复完成后，合并回主分支和开发分支</li></ul>]]></content>
    
    
    <categories>
      
      <category>总结</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>王道计算机组成原理</title>
    <link href="/2023/10/18/%E7%8E%8B%E9%81%93%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"/>
    <url>/2023/10/18/%E7%8E%8B%E9%81%93%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="done-1-10"><a href="#done-1-10" class="headerlink" title="done  1-10"></a>done  1-10</h2><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231018224323278.png" alt="image-20231018224323278"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231019091343092.png" alt="image-20231019091343092"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231019092506455.png" alt="image-20231019092506455"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231019092907677.png" alt="image-20231019092907677"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231019111416514.png" alt="image-20231019111416514"></p><h2 id="11-20"><a href="#11-20" class="headerlink" title="11-20"></a>11-20</h2><h3 id="带符号整数"><a href="#带符号整数" class="headerlink" title="带符号整数"></a>带符号整数</h3><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020111421887.png" alt="image-20231020111421887"></p><h3 id="反码"><a href="#反码" class="headerlink" title="反码"></a>反码</h3><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020111826533.png" alt="image-20231020111826533"></p><h3 id="源码和补码的快速转换"><a href="#源码和补码的快速转换" class="headerlink" title="源码和补码的快速转换"></a>源码和补码的快速转换</h3><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020112159999.png" alt="image-20231020112159999"></p><h3 id="补码的运算"><a href="#补码的运算" class="headerlink" title="补码的运算"></a>补码的运算</h3><p>源码转补码 进行运算，运算结果再转为源码，得到运算结果（补码的运算过程中，符号位参与运算）</p><p>已知一数字的补码，求其负值的补码表示</p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020120440469.png" alt="image-20231020120440469"></p><p><strong>重点</strong>  原码 和补码  补码与其负值的补码间的关系</p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020121658541.png" alt="image-20231020121658541"></p><h3 id="各种码的基本特性比较"><a href="#各种码的基本特性比较" class="headerlink" title="各种码的基本特性比较"></a>各种码的基本特性比较</h3><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231020122354358.png" alt="image-20231020122354358"></p><h3 id="移码"><a href="#移码" class="headerlink" title="移码"></a>移码</h3><p>补码的基础上将符号位取反</p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021142921215.png" alt="image-20231021142921215"></p><h3 id="考题"><a href="#考题" class="headerlink" title="考题"></a><strong>考题</strong></h3><ol><li>求一个真值的原码 反码 补码 移码</li><li>用一个已知的原码 | 反码 | 补码 |  移码 求其真值</li></ol><p>其中 移码 求 真值的方法如下：</p><ul><li>正数相同</li><li>负数从第一个1开始，从右向左所有的<strong>数值位</strong>取反</li></ul><p><strong>eg:</strong></p><p>[x]补&#x3D;1000 1101 </p><p>从第一个1开始，从右向左所有的数值位取反 得: 1111 0011 ，得（64+32+16+2+1）*-1&#x3D;-115</p><h3 id="定点小数"><a href="#定点小数" class="headerlink" title="定点小数"></a>定点小数</h3><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021200644577.png" alt="image-20231021200644577"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021200631457.png" alt="image-20231021200631457"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021200919981.png" alt="image-20231021200919981"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021201754179.png" alt="image-20231021201754179"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021204937931.png" alt="image-20231021204937931"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021204923740.png" alt="image-20231021204923740"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231021205324117.png" alt="image-20231021205324117"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>腾讯云文件上传</title>
    <link href="/2023/10/18/%E8%85%BE%E8%AE%AF%E4%BA%91%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <url>/2023/10/18/%E8%85%BE%E8%AE%AF%E4%BA%91%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
    
    <content type="html"><![CDATA[<p><a href="https://cloud.tencent.com/document/product/598/37140">访问管理 子账号访问密钥管理-用户指南-文档中心-腾讯云 (tencent.com)</a></p><p><a href="https://www.vpsss.net/21684.html">腾讯云API密钥APPID&#x2F;SecretId&#x2F;SecretKey如何获取？-魏艾斯笔记 (vpsss.net)</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>使用Go实现验证码发送服务</title>
    <link href="/2023/10/17/%E4%BD%BF%E7%94%A8Go%E5%AE%9E%E7%8E%B0%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8F%91%E9%80%81%E6%9C%8D%E5%8A%A1/"/>
    <url>/2023/10/17/%E4%BD%BF%E7%94%A8Go%E5%AE%9E%E7%8E%B0%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8F%91%E9%80%81%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="使用Go实现验证码发送服务"><a href="#使用Go实现验证码发送服务" class="headerlink" title="使用Go实现验证码发送服务"></a>使用Go实现验证码发送服务</h1><h2 id="邮箱服务配置"><a href="#邮箱服务配置" class="headerlink" title="邮箱服务配置"></a>邮箱服务配置</h2><p>这里我们选择qq邮箱作为案例</p><ul><li><a href="https://service.mail.qq.com/detail/0/141">帮助系统 (qq.com)</a></li></ul><h2 id="使用第三包实现邮件服务配置"><a href="#使用第三包实现邮件服务配置" class="headerlink" title="使用第三包实现邮件服务配置"></a>使用第三包实现邮件服务配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">go get github.com/jordan-wright/email<br></code></pre></td></tr></table></figure><h2 id="利用Redis中的string的可设置过期这一特性"><a href="#利用Redis中的string的可设置过期这一特性" class="headerlink" title="利用Redis中的string的可设置过期这一特性"></a>利用Redis中的string的可设置过期这一特性</h2><h3 id="配置-Redis"><a href="#配置-Redis" class="headerlink" title="配置 Redis"></a>配置 Redis</h3><h4 id="导入redis的包"><a href="#导入redis的包" class="headerlink" title="导入redis的包"></a>导入redis的包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">go get github.com/go-redis/redis/v8<br></code></pre></td></tr></table></figure><h4 id="初始化redis"><a href="#初始化redis" class="headerlink" title="初始化redis"></a>初始化redis</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> RDB = InitRedis(<span class="hljs-string">&quot;localhost:6379&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitRedis</span><span class="hljs-params">(addr <span class="hljs-type">string</span>)</span></span> *redis.Client &#123;<br>   <span class="hljs-keyword">return</span> redis.NewClient(&amp;redis.Options&#123;<br>      Addr:     addr,<br>      Password: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">// no password set</span><br>      DB:       <span class="hljs-number">0</span>,  <span class="hljs-comment">// use default DB</span><br>   &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Go验证码服务逻辑"><a href="#Go验证码服务逻辑" class="headerlink" title="Go验证码服务逻辑"></a>Go验证码服务逻辑</h2><p>我们使用Redis存储<code>邮箱-验证码</code>的键值对，并设置过期时间。</p><p>如将过期时间设置为5分钟，那么在一对键值对插入数据库的5分钟后Redis就会将其删除。这样就实现了验证码在一定时间后过期失效的功能。</p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestEmail</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>e := email.NewEmail()<br>e.From = <span class="hljs-string">&quot;yansaitao@qq.com&quot;</span><br>e.To = []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;2674978072@qq.com&quot;</span>&#125;<br><br>e.Subject = <span class="hljs-string">&quot;Validation Code Sending Test&quot;</span><br>e.HTML = []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;&lt;h1&gt;Your Validation Code is &quot;</span> + helper.GenerateRandomCode() + <span class="hljs-string">&quot;&lt;/h1&gt;&quot;</span>)<br>err := e.SendWithTLS(<span class="hljs-string">&quot;smtp.qq.com:465&quot;</span>, smtp.PlainAuth(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;yansaitao@qq.com&quot;</span>, defined.MailPassword, <span class="hljs-string">&quot;smtp.qq.com&quot;</span>),<br>&amp;tls.Config&#123;InsecureSkipVerify: <span class="hljs-literal">true</span>, ServerName: <span class="hljs-string">&quot;smtp.qq.com&quot;</span>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>t.Fatal(err)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>这里我们注意</strong></p><ul><li>smtp的端口号为25，但这里需要安全登录，所以我们需要使用 465端口来实现加密通信，以满足安全需求</li><li>defined.MailPassword 为第一步中设置qq邮箱，所得到的授权码</li></ul><p>生成随机验证码</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GenerateRandomCode</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> &#123;<br>s := <span class="hljs-string">&quot;1234567890&quot;</span><br>code := <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment">// import random seed, or that random code will always be the same one</span><br>rand.Seed(time.Now().UnixNano())<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; defined.CodeLength; i++ &#123;<br>code += <span class="hljs-type">string</span>(s[rand.Intn(<span class="hljs-built_in">len</span>(s))])<br>&#125;<br><span class="hljs-keyword">return</span> code<br>&#125;<br></code></pre></td></tr></table></figure><p>其中的 defined.CodeLength为自定义验证码长度</p><h2 id="具体的业务逻辑实现"><a href="#具体的业务逻辑实现" class="headerlink" title="具体的业务逻辑实现"></a>具体的业务逻辑实现</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *MailCodeSendRegisterLogic)</span></span> MailCodeSendRegister(req *types.MailCodeSendRequest) (resp *types.MailCodeSendReply, err <span class="hljs-type">error</span>) &#123;<br><span class="hljs-comment">// check whether the email has been registered</span><br>cnt, err := l.svcCtx.Engine.Where(<span class="hljs-string">&quot;email = ?&quot;</span>, req.Email).Count(<span class="hljs-built_in">new</span>(model.UserBasic))<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> cnt &gt; <span class="hljs-number">0</span> &#123;<br>err = errors.New(<span class="hljs-string">&quot;this Email has registered before&quot;</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// generate random validation code</span><br>code := helper.GenerateRandomCode()<br><br><span class="hljs-comment">// store the email-code kv pair into</span><br>l.svcCtx.RDB.Set(l.ctx, req.Email, code, time.Second*time.Duration(defined.CodeExpirationTime))<br><br>err = helper.MailSendCode(req.Email, code)<br>resp = &amp;types.MailCodeSendReply&#123;Code: code&#125;<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><p>其中 CodeExpirationTime为过期的时间，单位为秒</p>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
      <category>笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>笔记</tag>
      
      <tag>邮箱</tag>
      
      <tag>web</tag>
      
      <tag>golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【读Go专家编程】之String篇</title>
    <link href="/2023/10/15/%E3%80%90%E8%AF%BBGo%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%91%E4%B9%8BString%E7%AF%87/"/>
    <url>/2023/10/15/%E3%80%90%E8%AF%BBGo%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%91%E4%B9%8BString%E7%AF%87/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>【奇思妙想】</title>
    <link href="/2023/10/14/%E3%80%90%E5%A5%87%E6%80%9D%E5%A6%99%E6%83%B3%E3%80%91/"/>
    <url>/2023/10/14/%E3%80%90%E5%A5%87%E6%80%9D%E5%A6%99%E6%83%B3%E3%80%91/</url>
    
    <content type="html"><![CDATA[<p>我想写一个图床</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>【读Go专家编程】之Channel篇</title>
    <link href="/2023/10/13/%E3%80%90%E8%AF%BBGo%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%91%E4%B9%8BChannel%E7%AF%87/"/>
    <url>/2023/10/13/%E3%80%90%E8%AF%BBGo%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%91%E4%B9%8BChannel%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><ul><li>channel是Golang在语言层面提供的goroutine间的通信方式，比Unix管道更易用也更轻便。</li><li>channel主要用于进程内各goroutine间通信，如果需要跨进程通信，建议使用分布式系统的方法来解决。</li></ul><h3 id="Chan-数据结构"><a href="#Chan-数据结构" class="headerlink" title="Chan 数据结构"></a>Chan 数据结构</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> hchan <span class="hljs-keyword">struct</span> &#123;<br>    qcount   <span class="hljs-type">uint</span>           <span class="hljs-comment">// 当前队列中剩余元素个数</span><br>    dataqsiz <span class="hljs-type">uint</span>           <span class="hljs-comment">// 环形队列长度，即可以存放的元素个数</span><br>    buf      unsafe.Pointer <span class="hljs-comment">// 环形队列指针</span><br>    elemsize <span class="hljs-type">uint16</span>         <span class="hljs-comment">// 每个元素的大小</span><br>    closed   <span class="hljs-type">uint32</span>            <span class="hljs-comment">// 标识关闭状态</span><br>    elemtype *_type         <span class="hljs-comment">// 元素类型</span><br>    sendx    <span class="hljs-type">uint</span>           <span class="hljs-comment">// 队列下标，指示元素写入时存放到队列中的位置</span><br>    recvx    <span class="hljs-type">uint</span>           <span class="hljs-comment">// 队列下标，指示元素从队列的该位置读出</span><br>    recvq    waitq          <span class="hljs-comment">// 等待读消息的goroutine队列</span><br>    sendq    waitq          <span class="hljs-comment">// 等待写消息的goroutine队列</span><br>    lock mutex              <span class="hljs-comment">// 互斥锁，chan不允许并发读写</span><br>&#125;<br></code></pre></td></tr></table></figure><p>可以看出，Chan由 队列、信息类型、goroutine等灯盖队列组成</p><h4 id="环形队列"><a href="#环形队列" class="headerlink" title="环形队列"></a>环形队列</h4><p>chan内部实现了一个环形队列作为其缓冲区，队列的长度是创建Chan时指定的。</p><h4 id="等待队列"><a href="#等待队列" class="headerlink" title="等待队列"></a>等待队列</h4><ul><li>从Channel中读取数据时，如果缓冲区为空，此时的G被阻塞</li><li>从Channel中写数据时，如果缓冲区满了，此时的G被阻塞</li></ul><p>被阻塞的G会挂在Channel的等待队列中</p><ul><li>因为读阻塞的G会被向Channel写的G唤醒</li><li>因为写阻塞的G会被向Channel读的G唤醒</li></ul><h4 id="信息类型"><a href="#信息类型" class="headerlink" title="信息类型"></a>信息类型</h4><p>一个Channel只能传递一种类型的值，类型信息存储在hchan的数据结构中</p><ul><li>elemtype代表类型，用于数据传递过程中的赋值；</li><li>elemsize代表类型大小，用于在buf中定位元素位置。</li></ul><h4 id="Mutex"><a href="#Mutex" class="headerlink" title="Mutex"></a>Mutex</h4><ul><li>一个channel仅同时允许被一个goroutine读写</li></ul><h3 id="从Channel中写数据"><a href="#从Channel中写数据" class="headerlink" title="从Channel中写数据"></a>从Channel中写数据</h3><ul><li>如果等待接受队列recvq不为空，说明缓冲区没有数据或者没有缓冲区，此时直接将recvq 取出G,把数据写入其中，最后把该G唤醒，结束发送过程（Channel大小为0的情形）</li><li>如果缓冲区中还有空余位置，直接将数据写入缓存区，结束发送过程（Channel没满，还可以继续写）</li><li>如果缓冲区中没有空余位置，将待发送的数据写入G中，将当前G加入sendq，进入睡眠，等待读G唤醒（Channel满了）</li></ul><h3 id="从Channel中读数据"><a href="#从Channel中读数据" class="headerlink" title="从Channel中读数据"></a>从Channel中读数据</h3><ul><li>如果等待发送队列sendq不为空&amp;&amp;没有缓冲区，直接从sendq中读取G，把阻塞的G唤醒，结束读取过程（Channel大小为0的情形）</li><li>如果等待发送队列不为空，则缓冲区已满，从缓冲区首部读取出数据，把G中数据写入缓冲区尾部，等待发送队列的首部元素唤醒，结束读取过程（Channel满了，并且还有一大堆的G等待着给Channel发送数据，在那块阻塞等待着）</li><li>如果缓存区中有数据，则从缓冲区中读取数据，结束读取过程（Channel还没满，正常读取队列的首部）</li><li>如果sendq为空，等待，进入睡眠，等待被写G唤醒（没数据了，等着有人写数据进来）</li></ul><h3 id="Channel的用法"><a href="#Channel的用法" class="headerlink" title="Channel的用法"></a>Channel的用法</h3><ul><li>channel的只读和只写</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-comment">// &lt;-chan 只读</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">readChan</span><span class="hljs-params">(chanName &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)</span></span> &#123;<br>fmt.Println(&lt;-chanName)<br>&#125;<br><span class="hljs-comment">//chan&lt;- 只写</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">writeChan</span><span class="hljs-params">(chanName <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-type">int</span>)</span></span> &#123;<br>chanName &lt;- <span class="hljs-number">1</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> mychan = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br>writeChan(mychan)<br>readChan(mychan)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>select</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addNumberToChan</span><span class="hljs-params">(chanName <span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)</span></span> &#123;<br><span class="hljs-keyword">for</span> &#123;<br>chanName &lt;- <span class="hljs-number">1</span><br>time.Sleep(<span class="hljs-number">1</span> * time.Second)<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> chan1 = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br><span class="hljs-keyword">var</span> chan2 = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br><span class="hljs-keyword">go</span> addNumberToChan(chan1)<br><span class="hljs-keyword">go</span> addNumberToChan(chan2)<br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> e := &lt;-chan1:<br>fmt.Printf(<span class="hljs-string">&quot;Get element from chan1: %d\n&quot;</span>, e)<br><span class="hljs-keyword">case</span> e := &lt;-chan2:<br>fmt.Printf(<span class="hljs-string">&quot;Get element from chan2: %d\n&quot;</span>, e)<br><span class="hljs-keyword">default</span>:<br>fmt.Printf(<span class="hljs-string">&quot;No element in chan1 and chan2.\n&quot;</span>)<br>time.Sleep(<span class="hljs-number">1</span> * time.Second)<br>&#125;<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>程序中创建两个channel： chan1和chan2。函数addNumberToChan()函数会向两个channel中周期性写入数据。通过select可以监控两个channel，任意一个可读时就从其中读出数据。</p><ul><li>range</li></ul><p>通过range可以持续从Channel中读取数据，好像在遍历整个数组一样，当Channel中没有数据时，会阻塞当前G，与读channel一样处理</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">chanRange</span><span class="hljs-params">(chanName <span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)</span></span> &#123;<br>    <span class="hljs-keyword">for</span> e := <span class="hljs-keyword">range</span> chanName &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;Get element from chan: %d\n&quot;</span>, e)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>注意</strong>：如果向此channel写数据的goroutine退出时，系统检测到这种情况后会panic，否则range将会永久阻塞</p>]]></content>
    
    
    
    <tags>
      
      <tag>Go专家编程</tag>
      
      <tag>Channel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【读Go专家编程】之Slice篇</title>
    <link href="/2023/10/13/%E3%80%90%E8%AF%BBGo%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%91%E4%B9%8BSlice%E7%AF%87/"/>
    <url>/2023/10/13/%E3%80%90%E8%AF%BBGo%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%91%E4%B9%8BSlice%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h2 id="Slice的实现原理"><a href="#Slice的实现原理" class="headerlink" title="Slice的实现原理"></a>Slice的实现原理</h2><p>Slice依托数组实现，底层数组对用户屏蔽，底层数组在Cap不足时，会自动扩容，生成一个新的Slice</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> slice <span class="hljs-keyword">struct</span> &#123;<br>    array unsafe.Pointer<br>    <span class="hljs-built_in">len</span>   <span class="hljs-type">int</span><br>    <span class="hljs-built_in">cap</span>   <span class="hljs-type">int</span><br>&#125;<br></code></pre></td></tr></table></figure><p>从数据结构看Slice很清晰, array指针指向底层数组，len表示切片长度，cap表示底层数组容量</p><h2 id="使用Array创建Slice"><a href="#使用Array创建Slice" class="headerlink" title="使用Array创建Slice"></a>使用Array创建Slice</h2><p>当我们用Array创建Slice时，所创建的Slice会和原数组公用一部分内存</p><p>eg: slice:&#x3D;<code>array[5:7]</code> </p><p><img src="https://static.sitestack.cn/projects/GoExpertProgramming/chapter01/images/slice-02-create_slice_from_array.png"></p><p><strong>注意</strong>：创建的Slice的cap为array的5那个位置开始到array的末尾位置（所以，slice的cap为9-5+1）</p><h2 id="Slice的扩容"><a href="#Slice的扩容" class="headerlink" title="Slice的扩容"></a>Slice的扩容</h2><p>当Cap小于Len时，元素插不进去了，所以开始扩容</p><h3 id="扩容策略"><a href="#扩容策略" class="headerlink" title="扩容策略"></a>扩容策略</h3><ul><li>如果原Slice容量小于1024，则新Slice容量将扩大为原来的2倍；</li><li>如果原Slice容量大于等于1024，则新Slice容量将扩大为原来的1.25倍；</li></ul><h3 id="append-的过程"><a href="#append-的过程" class="headerlink" title="append 的过程"></a>append 的过程</h3><ul><li>假如Slice容量够用，则将新元素追加进去，Slice.len++，返回原Slice</li><li>原Slice容量不够，则将Slice先扩容，扩容后得到新Slice</li><li>将新元素追加进新Slice，Slice.len++，返回新的Slice。</li></ul><h2 id="Slice-Copy"><a href="#Slice-Copy" class="headerlink" title="Slice Copy"></a>Slice Copy</h2><p>Go 标准库提供了 <code>copy</code> 函数，可以用于将一个切片的内容复制到另一个切片。这种方法允许你精确控制复制的元素数量。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">originalSlice := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;<br>copiedSlice := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">3</span>) <span class="hljs-comment">// 创建一个长度为3的目标切片</span><br><span class="hljs-built_in">copy</span>(copiedSlice, originalSlice[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>]) <span class="hljs-comment">// 复制 originalSlice 中的第2到第4个元素到 copiedSlice</span><br></code></pre></td></tr></table></figure><h2 id="一种不太常见的slice用法"><a href="#一种不太常见的slice用法" class="headerlink" title="一种不太常见的slice用法"></a>一种不太常见的slice用法</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">sliceA := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment">//length = 5; capacity = 10</span><br>sliceB := sliceA[<span class="hljs-number">0</span>:<span class="hljs-number">5</span>]         <span class="hljs-comment">//length = 5; capacity = 10</span><br>sliceC := sliceA[<span class="hljs-number">0</span>:<span class="hljs-number">5</span>:<span class="hljs-number">5</span>]       <span class="hljs-comment">//length = 5; capacity = 5</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Slice</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Sort包的使用</title>
    <link href="/2023/09/23/Sort%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/09/23/Sort%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="Sort包的简介"><a href="#Sort包的简介" class="headerlink" title="Sort包的简介"></a>Sort包的简介</h2><p>Go语言标准库sort包中实现了３种基本的排序算法：<strong>插入排序</strong>、<strong>快排和堆排序</strong>。和其他语言中一样， 这三种方式都是不公开的，他们只在sort包内部使用。所以用户在使用sort包进行排序时无需考虑使 用那种排序方式，sort.Interface定义的三个方法：获取数据集合长度的Len()方法、比较两个元素 大小的Less()方法和交换两个元素位置的Swap()方法，就可以顺利对数据集合进行排序。sort包会 根据实际数据<strong>自动</strong>选择高效的排序算法。</p><h2 id="Sort包的使用"><a href="#Sort包的使用" class="headerlink" title="Sort包的使用"></a>Sort包的使用</h2><blockquote><p>Sort中有给基本数据类型如 int float 和string自定义sort</p></blockquote><h3 id="int-的排序"><a href="#int-的排序" class="headerlink" title="[]int 的排序"></a>[]int 的排序</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">arr := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">10</span>&#125;<br>sort.Ints(arr)<br><br>sort.Sort(sort.IntSlice(arr))<br><span class="hljs-comment">//默认结果都是升序排列，如果我们想对一个 sortable object 进行逆序排序，可以自定义一个type。但 sort.Reverse 帮你省掉了这些代码。</span><br>sort.Sort(sort.Reverse(sort.IntSlice(arr)))<br></code></pre></td></tr></table></figure><h3 id="string的排序"><a href="#string的排序" class="headerlink" title="[]string的排序"></a>[]string的排序</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">ss := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-string">&quot;ff&quot;</span>, <span class="hljs-string">&quot;-1&quot;</span>&#125;<br>sort.Strings(ss)<br><br>sort.Sort(sort.StringSlice(ss))<br><br>sort.Sort(sort.Reverse(sort.StringSlice(ss)))<br></code></pre></td></tr></table></figure><h3 id="float64-的排序"><a href="#float64-的排序" class="headerlink" title="[]float64 的排序"></a>[]float64 的排序</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go">fs := []<span class="hljs-type">float64</span>&#123;<span class="hljs-number">1.3</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">-90.2</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>&#125;<br>sort.Float64s(fs)<br><span class="hljs-comment">//查看是否已经排序成功（从小到大）</span><br>sort.IsSorted(sort.Float64Slice(fs))<br><br>sort.Sort(sort.Reverse(sort.Float64Slice(fs)))<br><br></code></pre></td></tr></table></figure><h3 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h3><p>go语言中的二分查找算法用来搜索指定<strong>已经排完序</strong>的切片[0:n]中值为Value的元素的<strong>下标</strong>，如果有多个相同Value的元素，则返回<strong>第一个</strong>值为Value的元素的下标；如果不存值为Value的元素，则返回切片的长度 <strong>n</strong> </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go">nums := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">13</span>&#125;<br><br><span class="hljs-comment">// 要查找的值</span><br>target := <span class="hljs-number">7</span><br><br><span class="hljs-comment">// 使用Search函数查找值的索引</span><br>index := sort.Search(<span class="hljs-built_in">len</span>(nums), <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">return</span> nums[i] &gt; target<br>&#125;)<br><br><span class="hljs-comment">// 检查是否找到</span><br><span class="hljs-keyword">if</span> index &lt; <span class="hljs-built_in">len</span>(nums) &amp;&amp; nums[index] == target &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%d 找到在索引 %d 处\n&quot;</span>, target, index)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%d 未找到\n&quot;</span>, target)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="自定义排序"><a href="#自定义排序" class="headerlink" title="自定义排序"></a>自定义排序</h3><blockquote><p>自定义sort.Interface排序 ,此时我们 需要重写 Swap Less Len 方法</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;sort&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Peak <span class="hljs-keyword">struct</span> &#123;<br>Name   <span class="hljs-type">string</span><br>Height <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Peaks []Peak<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ps Peaks)</span></span> Len() <span class="hljs-type">int</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(ps)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ps Peaks)</span></span> Less(i, j <span class="hljs-type">int</span>) <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">return</span> ps[i].Height &lt; ps[j].Height<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ps Peaks)</span></span> Swap(i, j <span class="hljs-type">int</span>) &#123;<br>ps[i], ps[j] = ps[j], ps[i]<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ps := Peaks&#123;&#123;<br>Name:   <span class="hljs-string">&quot;mountain-1&quot;</span>,<br>Height: <span class="hljs-number">1</span>,<br>&#125;, &#123;<br>Name:   <span class="hljs-string">&quot;mountain-2&quot;</span>,<br>Height: <span class="hljs-number">2</span>,<br>&#125;, &#123;<br>Name:   <span class="hljs-string">&quot;mountain-10&quot;</span>,<br>Height: <span class="hljs-number">-100</span>,<br>&#125;&#125;<br>fmt.Println(<span class="hljs-string">&quot;before &quot;</span>, ps)<br>sort.Sort(ps)<br>fmt.Println(<span class="hljs-string">&quot;after &quot;</span>, ps)<br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>使用 sort.Slice</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;sort&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Peak <span class="hljs-keyword">struct</span> &#123;<br>Name   <span class="hljs-type">string</span><br>Height <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Peaks []Peak<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ps Peaks)</span></span> Len() <span class="hljs-type">int</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(ps)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ps Peaks)</span></span> Less(i, j <span class="hljs-type">int</span>) <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">return</span> ps[i].Height &lt; ps[j].Height<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ps Peaks)</span></span> Swap(i, j <span class="hljs-type">int</span>) &#123;<br>ps[i], ps[j] = ps[j], ps[i]<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ps := Peaks&#123;&#123;<br>Name:   <span class="hljs-string">&quot;mountain-1&quot;</span>,<br>Height: <span class="hljs-number">1</span>,<br>&#125;, &#123;<br>Name:   <span class="hljs-string">&quot;mountain-2&quot;</span>,<br>Height: <span class="hljs-number">2</span>,<br>&#125;, &#123;<br>Name:   <span class="hljs-string">&quot;mountain-10&quot;</span>,<br>Height: <span class="hljs-number">-100</span>,<br>&#125;&#125;<br>fmt.Println(<span class="hljs-string">&quot;Before &quot;</span>, ps)<br>sort.Slice(ps, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i, j <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">return</span> ps[i].Height &lt;= ps[j].Height<br>&#125;)<br>fmt.Println(<span class="hljs-string">&quot;After &quot;</span>, ps)<br><br>fmt.Println(<span class="hljs-string">&quot;----------------&quot;</span>)<br>sort.Slice(ps, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i, j <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">return</span> ps[i].Height &gt;= ps[j].Height<br>&#125;)<br>fmt.Println(<span class="hljs-string">&quot;after reverse &quot;</span>, ps)<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>-golang -sort包的使用</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golang中的GC</title>
    <link href="/2023/09/22/Golang%E4%B8%AD%E7%9A%84GC/"/>
    <url>/2023/09/22/Golang%E4%B8%AD%E7%9A%84GC/</url>
    
    <content type="html"><![CDATA[<p>三色标记</p><p>混合写屏障</p><p>Mark Sweep的缺点</p><ul><li>STW，stop the world；让程序暂停，程序出现卡顿 **(重要问题)**；</li><li>标记需要扫描整个heap；</li><li>清除数据会产生heap碎片。</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>【2023年目标】</title>
    <link href="/2023/09/17/%E3%80%902023%E5%B9%B4%E7%9B%AE%E6%A0%87%E3%80%91/"/>
    <url>/2023/09/17/%E3%80%902023%E5%B9%B4%E7%9B%AE%E6%A0%87%E3%80%91/</url>
    
    <content type="html"><![CDATA[<ul><li><input disabled="" type="checkbox"> leetcode 400+</li><li><input disabled="" type="checkbox"> 项目 3+ 一个单体web 一个微服务web  一个轮子</li><li><input disabled="" type="checkbox"> 跑量 2000+</li><li><input checked="" disabled="" type="checkbox"> 阅读书籍 5+</li><li><input disabled="" type="checkbox"> 写blog 20+</li><li><input disabled="" type="checkbox"> 完成基本的计算机四大件的复习</li><li><input disabled="" type="checkbox"> 找一个女朋友</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>golang代码积累</title>
    <link href="/2023/09/13/golang%E4%BB%A3%E7%A0%81%E7%A7%AF%E7%B4%AF/"/>
    <url>/2023/09/13/golang%E4%BB%A3%E7%A0%81%E7%A7%AF%E7%B4%AF/</url>
    
    <content type="html"><![CDATA[<h3 id="连接字符串"><a href="#连接字符串" class="headerlink" title="连接字符串"></a>连接字符串</h3><ul><li><p>str1+str2</p></li><li><p>fmt.Sprintf(“%s%s”,str1,str2)</p></li><li><p>strings.Builder</p></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go">str1 := <span class="hljs-string">&quot;str1&quot;</span><br>str2 := <span class="hljs-string">&quot;str2&quot;</span><br><br>fmt.Println(str1 + str2)<br><br>fmt.Println(fmt.Sprintf(<span class="hljs-string">&quot;%s%s&quot;</span>, str1, str2))<br><br><span class="hljs-keyword">var</span> stringbuilder strings.Builder<br>stringbuilder.WriteString(str1)<br><br>stringbuilder.WriteString(str2)<br><br>fmt.Println(stringbuilder.String())<br></code></pre></td></tr></table></figure><h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Stack <span class="hljs-keyword">struct</span> &#123;<br>items []<span class="hljs-keyword">interface</span>&#123;&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stack)</span></span> Push(item <span class="hljs-keyword">interface</span>&#123;&#125;) &#123;<br>s.items = <span class="hljs-built_in">append</span>(s.items, item)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stack)</span></span> Pop() <span class="hljs-keyword">interface</span>&#123;&#125; &#123;<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(s.items) == <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br>item := s.items[<span class="hljs-built_in">len</span>(s.items)<span class="hljs-number">-1</span>]<br>s.items = s.items[:<span class="hljs-built_in">len</span>(s.items)<span class="hljs-number">-1</span>]<br><span class="hljs-keyword">return</span> item<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stack)</span></span> Peek() <span class="hljs-keyword">interface</span>&#123;&#125; &#123;<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(s.items) == <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><span class="hljs-keyword">return</span> s.items[<span class="hljs-built_in">len</span>(s.items)<span class="hljs-number">-1</span>]<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stack)</span></span> IsEmpty() <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(s.items) == <span class="hljs-number">0</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stack)</span></span> Size() <span class="hljs-type">int</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(s.items)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>stack := Stack&#123;&#125;<br><br>stack.Push(<span class="hljs-number">1</span>)<br>stack.Push(<span class="hljs-number">2</span>)<br>stack.Push(<span class="hljs-number">3</span>)<br><br>fmt.Println(<span class="hljs-string">&quot;Stack:&quot;</span>, stack.items)<br>fmt.Println(<span class="hljs-string">&quot;Top:&quot;</span>, stack.Peek())<br>fmt.Println(<span class="hljs-string">&quot;Pop:&quot;</span>, stack.Pop())<br>fmt.Println(<span class="hljs-string">&quot;Stack:&quot;</span>, stack.items)<br>fmt.Println(<span class="hljs-string">&quot;Is Empty?&quot;</span>, stack.IsEmpty())<br>fmt.Println(<span class="hljs-string">&quot;Size:&quot;</span>, stack.Size())<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Queue <span class="hljs-keyword">struct</span> &#123;<br>items []<span class="hljs-keyword">interface</span>&#123;&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span></span> Enqueue(item <span class="hljs-keyword">interface</span>&#123;&#125;) &#123;<br>q.items = <span class="hljs-built_in">append</span>(q.items, item)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span></span> Dequeue() <span class="hljs-keyword">interface</span>&#123;&#125; &#123;<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(q.items) == <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br>front := q.items[<span class="hljs-number">0</span>]<br>q.items = q.items[<span class="hljs-number">1</span>:]<br><span class="hljs-keyword">return</span> front<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span></span> Front() <span class="hljs-keyword">interface</span>&#123;&#125; &#123;<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(q.items) == <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><span class="hljs-keyword">return</span> q.items[<span class="hljs-number">0</span>]<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span></span> IsEmpty() <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(q.items) == <span class="hljs-number">0</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span></span> Size() <span class="hljs-type">int</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(q.items)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>queue := Queue&#123;&#125;<br><br>queue.Enqueue(<span class="hljs-number">1</span>)<br>queue.Enqueue(<span class="hljs-number">2</span>)<br>queue.Enqueue(<span class="hljs-number">3</span>)<br><br>fmt.Println(<span class="hljs-string">&quot;Queue:&quot;</span>, queue.items)<br>fmt.Println(<span class="hljs-string">&quot;Front:&quot;</span>, queue.Front())<br>fmt.Println(<span class="hljs-string">&quot;Dequeue:&quot;</span>, queue.Dequeue())<br>fmt.Println(<span class="hljs-string">&quot;Queue:&quot;</span>, queue.items)<br>fmt.Println(<span class="hljs-string">&quot;Is Empty?&quot;</span>, queue.IsEmpty())<br>fmt.Println(<span class="hljs-string">&quot;Size:&quot;</span>, queue.Size())<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="Priority-Queue"><a href="#Priority-Queue" class="headerlink" title="Priority Queue"></a>Priority Queue</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;container/heap&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Item <span class="hljs-keyword">struct</span> &#123;<br>value    <span class="hljs-type">string</span><br>priority <span class="hljs-type">int</span><br>&#125;<br><span class="hljs-keyword">type</span> PriorityQueue []*Item<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(pq PriorityQueue)</span></span> Len() <span class="hljs-type">int</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(pq)<br>&#125;<br><span class="hljs-comment">// &lt; 表示最小堆 返回堆顶，即priority最小的值</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(pq PriorityQueue)</span></span> Less(i, j <span class="hljs-type">int</span>) <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">return</span> pq[i].priority &lt; pq[j].priority<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(pq PriorityQueue)</span></span> Swap(i, j <span class="hljs-type">int</span>) &#123;<br>pq[i], pq[j] = pq[j], pq[i]<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(pq *PriorityQueue)</span></span> Push(x <span class="hljs-keyword">interface</span>&#123;&#125;) &#123;<br>item := x.(*Item)<br>*pq = <span class="hljs-built_in">append</span>(*pq, item)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(pq *PriorityQueue)</span></span> Pop() <span class="hljs-keyword">interface</span>&#123;&#125; &#123;<br>old := *pq<br>n := <span class="hljs-built_in">len</span>(old)<br>item := old[n<span class="hljs-number">-1</span>]<br>*pq = old[<span class="hljs-number">0</span> : n<span class="hljs-number">-1</span>]<br><span class="hljs-keyword">return</span> item<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>pq := <span class="hljs-built_in">make</span>(PriorityQueue, <span class="hljs-number">0</span>)<br><br>heap.Init(&amp;pq)<br>items := []*Item&#123;<br>&#123;<br>value:    <span class="hljs-string">&quot;C&quot;</span>,<br>priority: <span class="hljs-number">3</span>,<br>&#125;,<br>&#123;<br>value:    <span class="hljs-string">&quot;A&quot;</span>,<br>priority: <span class="hljs-number">1</span>,<br>&#125;,<br>&#123;<br>value:    <span class="hljs-string">&quot;B&quot;</span>,<br>priority: <span class="hljs-number">2</span>,<br>&#125;,<br>&#125;<br><span class="hljs-keyword">for</span> _, item := <span class="hljs-keyword">range</span> items &#123;<br>heap.Push(&amp;pq, item)<br>&#125;<br><br><span class="hljs-keyword">for</span> pq.Len() &gt; <span class="hljs-number">0</span> &#123;<br>item := heap.Pop(&amp;pq).(*Item)<br>fmt.Printf(<span class="hljs-string">&quot;%s( Priority:%d)&quot;</span>, item.value, item.priority)<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="层次遍历"><a href="#层次遍历" class="headerlink" title="层次遍历"></a>层次遍历</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">/**<br> * Definition for a binary tree node.<br> * type TreeNode struct &#123;<br> *     Val int<br> *     Left *TreeNode<br> *     Right *TreeNode<br> * &#125;<br> */<br></code></pre></td></tr></table></figure><h4 id="version-1"><a href="#version-1" class="headerlink" title="version 1"></a>version 1</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">levelOrder</span><span class="hljs-params">(root *TreeNode)</span></span>(res []<span class="hljs-type">int</span>)&#123;<br>    <span class="hljs-keyword">if</span> root==<span class="hljs-literal">nil</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>    &#125;<br>    cur:=<span class="hljs-built_in">make</span>([]*TreeNode,<span class="hljs-number">0</span>)<br>    cur=<span class="hljs-built_in">append</span>(cur,root)<br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">len</span>(cur)&gt;<span class="hljs-number">0</span>&#123;<br>        nodes:=<span class="hljs-built_in">make</span>([]*TreeNode,<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">for</span> _,node:=<span class="hljs-keyword">range</span> cur&#123;<br>            res=<span class="hljs-built_in">append</span>(res,node.Val)<br>            <span class="hljs-keyword">if</span> node.Left!=<span class="hljs-literal">nil</span>&#123;<br>                nodes=<span class="hljs-built_in">append</span>(nodes,node.Left)<br>            &#125;<br>            <span class="hljs-keyword">if</span> node.Right!=<span class="hljs-literal">nil</span>&#123;<br>                nodes=<span class="hljs-built_in">append</span>(nodes,node.Right)<br>            &#125;<br>        &#125;<br>        cur=nodes<br>    &#125;<br>    <span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="version-2"><a href="#version-2" class="headerlink" title="version 2"></a>version 2</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">levelOrder</span><span class="hljs-params">(root *TreeNode)</span></span>(res [][]<span class="hljs-type">int</span>)&#123;<br>    <span class="hljs-keyword">if</span> root==<span class="hljs-literal">nil</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>    &#125;<br>    cur:=<span class="hljs-built_in">make</span>([]*TreeNode,<span class="hljs-number">0</span>)<br>    <span class="hljs-comment">//将首元节点插入</span><br>    cur=<span class="hljs-built_in">append</span>(cur,root)<br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">len</span>(cur)&gt;<span class="hljs-number">0</span>&#123;<br>        tempRes:=<span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>,<span class="hljs-number">0</span>)<br>        nodes:=<span class="hljs-built_in">make</span>([]*TreeNode,<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">for</span> _,node:=<span class="hljs-keyword">range</span> cur&#123;<br>            tempRes=<span class="hljs-built_in">append</span>(tempRes,node.Val)<br>            <span class="hljs-keyword">if</span> node.Left!=<span class="hljs-literal">nil</span>&#123;<br>                nodes=<span class="hljs-built_in">append</span>(nodes,node.Left)<br>            &#125;<br>            <span class="hljs-keyword">if</span> node.Right!=<span class="hljs-literal">nil</span>&#123;<br>                nodes=<span class="hljs-built_in">append</span>(nodes,node.Right)<br>            &#125;<br>        &#125;<br>        res=<span class="hljs-built_in">append</span>(res,tempRes)<br>        cur=nodes<br>    &#125;<br>    <span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="version-3"><a href="#version-3" class="headerlink" title="version 3"></a>version 3</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">levelOrder</span><span class="hljs-params">(root *TreeNode)</span></span> (res [][]<span class="hljs-type">int</span>) &#123;<br><span class="hljs-keyword">if</span> root == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> [][]<span class="hljs-type">int</span>&#123;&#125;<br>&#125;<br>cur := <span class="hljs-built_in">make</span>([]*TreeNode,<span class="hljs-number">0</span>)<br>cur=<span class="hljs-built_in">append</span>(cur,root)<br>cnt := <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">len</span>(cur) &gt; <span class="hljs-number">0</span> &#123;<br>arr := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>)<br>nodes := <span class="hljs-built_in">make</span>([]*TreeNode, <span class="hljs-number">0</span>)<br><span class="hljs-keyword">for</span> _, node := <span class="hljs-keyword">range</span> cur &#123;<br><span class="hljs-keyword">if</span> node.Left != <span class="hljs-literal">nil</span> &#123;<br>nodes = <span class="hljs-built_in">append</span>(nodes, node.Left)<br>&#125;<br><span class="hljs-keyword">if</span> node.Right != <span class="hljs-literal">nil</span> &#123;<br>nodes = <span class="hljs-built_in">append</span>(nodes, node.Right)<br>&#125;<br>arr = <span class="hljs-built_in">append</span>(arr, node.Val)<br>&#125;<br><span class="hljs-keyword">if</span> cnt==<span class="hljs-number">-1</span>&#123;<br><span class="hljs-keyword">for</span> i,Len:=<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(arr);i&lt;<span class="hljs-built_in">len</span>(arr)/<span class="hljs-number">2</span>;i++&#123;<br>arr[Len<span class="hljs-number">-1</span>-i],arr[i]=arr[i],arr[Len<span class="hljs-number">-1</span>-i]<br>&#125;<br>&#125;<br>cnt*=<span class="hljs-number">-1</span><br>res=<span class="hljs-built_in">append</span>(res,arr)<br>cur = nodes<br>&#125;<br><span class="hljs-keyword">return</span> res<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="检查是否为二叉搜索树"><a href="#检查是否为二叉搜索树" class="headerlink" title="检查是否为二叉搜索树"></a>检查是否为二叉搜索树</h4><h3 id="二叉树的中序遍历"><a href="#二叉树的中序遍历" class="headerlink" title="二叉树的中序遍历"></a>二叉树的中序遍历</h3><h4 id="version-1-递归"><a href="#version-1-递归" class="headerlink" title="version 1 递归"></a>version 1 递归</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">inorderTraversal</span><span class="hljs-params">(root *TreeNode)</span></span> (res []<span class="hljs-type">int</span>) &#123;<br><span class="hljs-comment">//边界条件</span><br><span class="hljs-comment">//自定义函数</span><br>    re := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(root *TreeNode)</span></span> &#123;&#125;<br>re = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(root *TreeNode)</span></span> &#123;<br><span class="hljs-keyword">if</span> root == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> root.Left != <span class="hljs-literal">nil</span> &#123;<br>re(root.Left)<br>&#125;<br>res = <span class="hljs-built_in">append</span>(res, root.Val)<br><span class="hljs-keyword">if</span> root.Right != <span class="hljs-literal">nil</span> &#123;<br>re(root.Right)<br>&#125;<br>&#125;<br>re(root)<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="version-2-迭代"><a href="#version-2-迭代" class="headerlink" title="version 2 迭代"></a>version 2 迭代</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">isValidBST</span><span class="hljs-params">(root *TreeNode)</span></span><span class="hljs-type">bool</span>&#123;<br>    stack:=<span class="hljs-built_in">make</span>([]*TreeNode,<span class="hljs-number">0</span>)<br>    inorder:=math.MinInt64<br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">len</span>(stack)&gt;<span class="hljs-number">0</span>||root!=<span class="hljs-literal">nil</span>&#123;<br>        <span class="hljs-keyword">for</span> root!=<span class="hljs-literal">nil</span>&#123;<br>            stack=<span class="hljs-built_in">append</span>(stack,root)<br>            root=root.Left<br>        &#125;<br>        root=stack[<span class="hljs-built_in">len</span>(stack)<span class="hljs-number">-1</span>]<br>        stack=stack[:<span class="hljs-built_in">len</span>(stack)<span class="hljs-number">-1</span>]<br>        <span class="hljs-keyword">if</span> root.Val&lt;=inorder&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>        &#125;<br>        inorder=root.Val<br>        root=root.Right<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="计算二叉树的深度"><a href="#计算二叉树的深度" class="headerlink" title="计算二叉树的深度"></a>计算二叉树的深度</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">max</span><span class="hljs-params">(a,b <span class="hljs-type">int</span>)</span></span><span class="hljs-type">int</span>&#123;<br>    <span class="hljs-keyword">if</span> a&gt;b&#123;<br>        <span class="hljs-keyword">return</span> a<br>    &#125;<br>    <span class="hljs-keyword">return</span> b<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">maxDepth</span><span class="hljs-params">(root *TreeNode)</span></span><span class="hljs-type">int</span>&#123;<br>    <span class="hljs-keyword">var</span> dfs <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(root *TreeNode)</span></span><span class="hljs-type">int</span><br>    dfs=<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(root *TreeNode)</span></span><span class="hljs-type">int</span>&#123;<br>        <span class="hljs-keyword">if</span> root==<span class="hljs-literal">nil</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> max(dfs(root.Left),dfs(root.Right))+<span class="hljs-number">1</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> dfs(root)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="平衡二叉树的判断"><a href="#平衡二叉树的判断" class="headerlink" title="平衡二叉树的判断"></a>平衡二叉树的判断</h3><p>平衡二叉树中的每一个节点的左右子树的高度差不超过2</p><p>思路：在每一个节点求得其左右子树的高度，判断是否符合平衡二叉树的要求</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">max</span><span class="hljs-params">(a,b <span class="hljs-type">int</span>)</span></span><span class="hljs-type">int</span>&#123;<br><span class="hljs-keyword">if</span> a&gt;b&#123;<br><span class="hljs-keyword">return</span> a<br>&#125;<br><span class="hljs-keyword">return</span> b<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getDepth</span><span class="hljs-params">(root *TreeNode)</span></span><span class="hljs-type">int</span>&#123;<br><span class="hljs-keyword">if</span> root==<span class="hljs-literal">nil</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>&#125;<br><span class="hljs-keyword">return</span> max(getDepth(root.Left),getDepth(root.Right))+<span class="hljs-number">1</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">abs</span><span class="hljs-params">(a,b <span class="hljs-type">int</span>)</span></span><span class="hljs-type">int</span>&#123;<br><span class="hljs-keyword">if</span> a&gt;b&#123;<br><span class="hljs-keyword">return</span> a-b<br>&#125;<br><span class="hljs-keyword">return</span> b-a<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">isBalanced</span><span class="hljs-params">(root *TreeNode)</span></span><span class="hljs-type">bool</span>&#123;<br><span class="hljs-keyword">if</span> root==<span class="hljs-literal">nil</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br><span class="hljs-keyword">return</span> isBalanced(root.Left)&amp;&amp;<br>isBalanced(root.Right)&amp;&amp;abs(getDepth(root.Left),getDepth(root.Right))&lt;<span class="hljs-number">2</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="二叉搜索树与双向链表"><a href="#二叉搜索树与双向链表" class="headerlink" title="二叉搜索树与双向链表"></a>二叉搜索树与双向链表</h3><p>要求：不创建任何新的节点，只能调整树中节点指针的指向,最终形成一个有序的双向链表，返回头结点</p><p>思路：因为用中序遍历二叉搜索树，得到的是一个从小到大的有序结果，所以我们可以利用中序遍历的特性，在其中把节点与节点连接起来，最终就可以得到一个有序双向链表</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    Node* head=<span class="hljs-literal">nullptr</span>;<br>    Node *prev=<span class="hljs-literal">nullptr</span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(Node* cur)</span></span>&#123;<br>       <span class="hljs-keyword">if</span>(cur==<span class="hljs-literal">NULL</span>)&#123;<br>           <span class="hljs-keyword">return</span> ;<br>       &#125;<br>        <span class="hljs-built_in">dfs</span>(cur-&gt;left);<br>        <span class="hljs-comment">//找到tree中最小值</span><br>        <span class="hljs-keyword">if</span> (head==<span class="hljs-literal">NULL</span>)&#123;<br>            head=cur;<br>            prev=cur;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">//找到较小值</span><br>            prev-&gt;right=cur;<br>            cur-&gt;left=prev;<br>            prev=cur;<br>        &#125;<br>        <span class="hljs-built_in">dfs</span>(cur-&gt;right);<br>    &#125;<br>    <span class="hljs-function">Node* <span class="hljs-title">treeToDoublyList</span><span class="hljs-params">(Node* root)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (root==<span class="hljs-literal">NULL</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>        &#125;<br>        <span class="hljs-built_in">dfs</span>(root);<br>        <span class="hljs-comment">//双向链表收尾相连</span><br>        prev-&gt;right=head;<br>        head-&gt;left=prev;<br>        <span class="hljs-keyword">return</span> head;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="重构二叉树"><a href="#重构二叉树" class="headerlink" title="重构二叉树"></a><strong>重构二叉树</strong></h3><p>根据前序遍历和中序遍历重构 得到后序遍历</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">buildTree</span><span class="hljs-params">(pr []<span class="hljs-type">int</span>, in []<span class="hljs-type">int</span>)</span></span> (head *TreeNode) &#123;<br><span class="hljs-keyword">var</span> dfs <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(pr []<span class="hljs-type">int</span>, in []<span class="hljs-type">int</span>, l0 <span class="hljs-type">int</span>, r0 <span class="hljs-type">int</span>, l1 <span class="hljs-type">int</span>, r1 <span class="hljs-type">int</span>)</span></span> *TreeNode<br><span class="hljs-comment">// 用map来快速得到中序遍历中pr[l0]的位置</span><br>    pos := <span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]<span class="hljs-type">int</span>&#123;&#125;<br><span class="hljs-keyword">for</span> idx, v := <span class="hljs-keyword">range</span> in &#123;<br>pos[v] = idx<br>&#125;<br>dfs = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(pr []<span class="hljs-type">int</span>, in []<span class="hljs-type">int</span>, l0 <span class="hljs-type">int</span>, r0 <span class="hljs-type">int</span>, l1 <span class="hljs-type">int</span>, r1 <span class="hljs-type">int</span>)</span></span> *TreeNode &#123;<br><span class="hljs-keyword">if</span> l0 &gt; r0 &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br>root := &amp;TreeNode&#123;Val: pr[l0]&#125;<br>idx := pos[pr[l0]]<br>lsize := idx - l1<br><span class="hljs-comment">//rsize:=r1-idx</span><br><span class="hljs-comment">// [l0+1,lsize+l0] [lsize+l0+1,r0]</span><br><span class="hljs-comment">// [l1,idx-1] [addr+1,r1]</span><br><br>root.Left = dfs(pr, in, l0+<span class="hljs-number">1</span>, lsize+l0, l1, idx<span class="hljs-number">-1</span>)<br>root.Right = dfs(pr, in, lsize+l0+<span class="hljs-number">1</span>, r0, idx+<span class="hljs-number">1</span>, r1)<br><span class="hljs-keyword">return</span> root<br>&#125;<br><br><span class="hljs-keyword">return</span> dfs(pr, in, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(pr)<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(in)<span class="hljs-number">-1</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="二叉搜索树的后序遍历"><a href="#二叉搜索树的后序遍历" class="headerlink" title="二叉搜索树的后序遍历"></a>二叉搜索树的后序遍历</h3><p>后序遍历中的最后一个结果是该遍历结果的根节点，可以从头遍历 遍历结果，查看小于根节点的元素，再往后遍历大于根节点的元素，如果其中有比根节点小的元素，则此二叉树不是二叉搜索树</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">verifyPostorder</span><span class="hljs-params">(postorder []<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">var</span> dfs <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(arr []<span class="hljs-type">int</span>, l, r <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span><br><br>dfs = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(arr []<span class="hljs-type">int</span>, l, r <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">if</span> r &lt;= l &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br>mid:=arr[r]<br><span class="hljs-keyword">var</span> p <span class="hljs-type">int</span>=l<br><span class="hljs-keyword">for</span> arr[p]&lt;mid&#123;<br>p++<br>&#125;<br><br><span class="hljs-keyword">var</span> idx <span class="hljs-type">int</span>=p<br><span class="hljs-keyword">for</span> arr[p]&gt;mid&#123;<br>p++<br>&#125;<br><span class="hljs-keyword">return</span> p==r&amp;&amp;dfs(arr,l,idx<span class="hljs-number">-1</span>)&amp;&amp;dfs(arr,idx,r<span class="hljs-number">-1</span>)<br>&#125;<br><span class="hljs-keyword">return</span> dfs(postorder, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(postorder)<span class="hljs-number">-1</span>)<br>&#125;   <br></code></pre></td></tr></table></figure><h3 id="lowerbit的求法"><a href="#lowerbit的求法" class="headerlink" title="lowerbit的求法"></a>lowerbit的求法</h3><p>lowerbit&#x3D;n&amp;(-n)</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//快速求得一个数在二进制中每一个1所在位置代表的值大小</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">hammingWeight</span><span class="hljs-params">(num <span class="hljs-type">uint32</span>)</span></span> (cnt <span class="hljs-type">int</span>) &#123;<br><span class="hljs-keyword">for</span> num &gt; <span class="hljs-number">0</span> &#123;<br>lowbit := num &amp; (-num)<br>num -= lowbit<br>cnt++<br>&#125;<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="位运算专题"><a href="#位运算专题" class="headerlink" title="位运算专题"></a>位运算专题</h2><h3 id="抑或的用法"><a href="#抑或的用法" class="headerlink" title="抑或的用法"></a>抑或的用法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 其中抑或相当于一个不会进位的加法</span><br>1^1=0<br>0^1=1<br>0^0=0<br><br><span class="hljs-comment">#两个相同的数向抑或，结果为0</span><br><span class="hljs-comment">#一个数与0向抑或的结果是原数</span><br>a^a=0<br>0^a=a<br><br>a^b=c<br>c^a=b<br>b^c=a<br></code></pre></td></tr></table></figure><p><a href="https://leetcode.cn/problems/count-triplets-that-can-form-two-arrays-of-equal-xor/description/">1442. 形成两个异或相等数组的三元组数目 - 力扣（LeetCode）</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//leetcode 1442</span><br><span class="hljs-comment">//</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">countTriplets</span><span class="hljs-params">(arr []<span class="hljs-type">int</span>)</span></span> (cnt <span class="hljs-type">int</span>) &#123;<br>n := <span class="hljs-built_in">len</span>(arr)<br>orres := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, n+<span class="hljs-number">1</span>)<br><br>orres[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> idx, v := <span class="hljs-keyword">range</span> arr &#123;<br>orres[idx+<span class="hljs-number">1</span>] = orres[idx] ^ v<br>&#125;<br><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= n; i++ &#123;<br><span class="hljs-keyword">for</span> j := i + <span class="hljs-number">1</span>; j &lt;=n &amp;&amp; i &lt; j; j++ &#123;<br><span class="hljs-keyword">if</span> orres[j]^orres[i<span class="hljs-number">-1</span>] == <span class="hljs-number">0</span> &#123;<br><span class="hljs-comment">//i j 可以</span><br>cnt += j - i <br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://leetcode.cn/problems/maximum-xor-of-two-numbers-in-an-array/">421. 数组中两个数的最大异或值 - 力扣（LeetCode）</a></p><p>构造 字典树 快速知晓数组中的其他数字的每一位的bit的大小，利用贪心，1^0&#x3D;1</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">max</span><span class="hljs-params">(a,b <span class="hljs-type">int</span>)</span></span><span class="hljs-type">int</span>&#123;<br><span class="hljs-keyword">if</span> a&gt;b&#123;<br><span class="hljs-keyword">return</span> a<br>&#125;<br><span class="hljs-keyword">return</span> b<br>&#125;<br><br><span class="hljs-keyword">const</span> heightbit=<span class="hljs-number">30</span><br><br><span class="hljs-keyword">type</span> trie <span class="hljs-keyword">struct</span> &#123;<br>left,right *trie<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *trie)</span></span> add(num <span class="hljs-type">int</span>)&#123;<br>cur:=t<br><span class="hljs-keyword">for</span> i:=heightbit;i&gt;=<span class="hljs-number">0</span>;i--&#123;<br>bit:=(num&gt;&gt;i)&amp;<span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> bit==<span class="hljs-number">0</span>&#123;<br><span class="hljs-keyword">if</span> cur.left==<span class="hljs-literal">nil</span>&#123;<br>cur.left=&amp;trie&#123;&#125;<br>                cur=cur.left<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>cur=cur.left<br>&#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">if</span> cur.right==<span class="hljs-literal">nil</span>&#123;<br>cur.right=&amp;trie&#123;&#125;<br>                cur=cur.right<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>cur=cur.right<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *trie)</span></span>check(num <span class="hljs-type">int</span>)(res <span class="hljs-type">int</span>)&#123;<br>cur:=t<br><span class="hljs-keyword">for</span> i:=heightbit;i&gt;=<span class="hljs-number">0</span>;i--&#123;<br>b:=(num&gt;&gt;i)&amp;<span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> b==<span class="hljs-number">0</span>&#123;<br><span class="hljs-comment">//需要1</span><br><span class="hljs-keyword">if</span> cur.right!=<span class="hljs-literal">nil</span>&#123;<br>res|=(<span class="hljs-number">1</span>&lt;&lt;i)<br>                cur=cur.right<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                cur=cur.left<br>            &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-comment">//需要0</span><br><span class="hljs-keyword">if</span> cur.left!=<span class="hljs-literal">nil</span>&#123;<br>res|=(<span class="hljs-number">1</span>&lt;&lt;i)<br>                cur=cur.left<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                cur=cur.right<br>            &#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">findMaximumXOR</span><span class="hljs-params">(nums []<span class="hljs-type">int</span>)</span></span> (x <span class="hljs-type">int</span>) &#123;<br>root := *&amp;trie&#123;&#125;<br><span class="hljs-keyword">for</span> i:=<span class="hljs-number">1</span>;i&lt;<span class="hljs-built_in">len</span>(nums);i++&#123;<br>root.add(nums[i<span class="hljs-number">-1</span>])<br>x = max(x, root.check(nums[i]))<br>&#125;<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>【redis】ZSet的使用</title>
    <link href="/2023/09/13/%E3%80%90redis%E3%80%91ZSet%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/09/13/%E3%80%90redis%E3%80%91ZSet%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="准备动作"><a href="#准备动作" class="headerlink" title="准备动作"></a>准备动作</h2><h3 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -d -p 6379:6379 --name redis redis<br></code></pre></td></tr></table></figure><h3 id="查看docke状态"><a href="#查看docke状态" class="headerlink" title="查看docke状态"></a>查看docke状态</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker ps<br></code></pre></td></tr></table></figure><h3 id="进入redis-cli"><a href="#进入redis-cli" class="headerlink" title="进入redis-cli"></a>进入redis-cli</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">redis-cli<br></code></pre></td></tr></table></figure><h2 id="Zset的基本指令集合"><a href="#Zset的基本指令集合" class="headerlink" title="Zset的基本指令集合"></a>Zset的基本指令集合</h2><h3 id="ZADD添加元素-O-log-N"><a href="#ZADD添加元素-O-log-N" class="headerlink" title="ZADD添加元素 O(log(N))"></a><strong>ZADD</strong>添加元素 O(log(N))</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs redis">zadd myzset 1 &quot;1&quot;<br></code></pre></td></tr></table></figure><h3 id="ZREM-删除元素"><a href="#ZREM-删除元素" class="headerlink" title="ZREM 删除元素"></a><strong>ZREM</strong> 删除元素</h3><p>​O(M*log(N)) with N being the number of elements in the sorted set and M the number of elements to be removed.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ZREM myzset &quot;one&quot;<br></code></pre></td></tr></table></figure><h3 id="ZCARD查看zset的元素个数O-1）"><a href="#ZCARD查看zset的元素个数O-1）" class="headerlink" title="ZCARD查看zset的元素个数O(1）"></a><strong>ZCARD</strong>查看zset的元素个数O(1）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zcard myzset <br></code></pre></td></tr></table></figure><h3 id="ZCOUNT-查看zset区间的与元素个数（默认为左闭右闭）O-log-N"><a href="#ZCOUNT-查看zset区间的与元素个数（默认为左闭右闭）O-log-N" class="headerlink" title="ZCOUNT 查看zset区间的与元素个数（默认为左闭右闭）O(log(N))"></a><strong>ZCOUNT</strong> 查看zset区间的与元素个数（默认为左闭右闭）O(log(N))</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zcount myzset 1 3#查看大于等于1小于等于3的<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zcount myzset (1 3 #查看大于1小于等于3的<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zcount myzset -inf +inf <br></code></pre></td></tr></table></figure><h3 id="ZINCRBY给元素添加值O-log-N"><a href="#ZINCRBY给元素添加值O-log-N" class="headerlink" title="ZINCRBY给元素添加值O(log(N)"></a><strong>ZINCRBY</strong>给元素添加值O(log(N)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ZINCRBY myzset -10 &quot;one&quot;<br></code></pre></td></tr></table></figure><h3 id="ZRANK-O-log-N"><a href="#ZRANK-O-log-N" class="headerlink" title="ZRANK O(log(N))"></a>ZRANK O(log(N))</h3><ul><li><p>键存在，返回排名（默认为从小到大排序），最小的排序名词为（0）</p></li><li><p>键不存在，返回nil</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zrank myzset &quot;one&quot;<br></code></pre></td></tr></table></figure></li></ul><h3 id="ZRANGE查询区间值的元素O-log-N-M"><a href="#ZRANGE查询区间值的元素O-log-N-M" class="headerlink" title="ZRANGE查询区间值的元素O(log(N)+M)"></a><strong>ZRANGE</strong>查询区间值的元素O(log(N)+M)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ZRANGE myzset -10 100 WITHSOCRES<br></code></pre></td></tr></table></figure><h3 id="ZINTERSTORE"><a href="#ZINTERSTORE" class="headerlink" title="ZINTERSTORE"></a><strong>ZINTERSTORE</strong></h3><p>有序集合（Sorted Set）的交集并将结果存储到新有序集合的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ZINTERSTORE destination numkeys key [key ...] [WEIGHTS weight [weight ...]] [AGGREGATE SUM|MIN|MAX]<br></code></pre></td></tr></table></figure><p>参数说明：</p><ul><li><code>destination</code>：目标有序集合的键名，用于存储交集结果。</li><li><code>numkeys</code>：指定参与计算的有序集合的数量。</li><li><code>key [key ...]</code>：要参与计算交集的有序集合的键名列表。</li><li><code>WEIGHTS weight [weight ...]</code>（可选）：用于指定每个有序集合的权重，可以调整每个成员分数的权重。如果不指定权重，则默认为 1。</li><li><code>AGGREGATE SUM|MIN|MAX</code>（可选）：用于指定计算交集时的聚合方式，可以是 SUM（求和，默认）、MIN（最小值）或 MAX（最大值）。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ZINTERSTORE intersection_max 2 set1 set2 AGGREGATE MAX<br></code></pre></td></tr></table></figure><h3 id="ZRANGEBULEX"><a href="#ZRANGEBULEX" class="headerlink" title="ZRANGEBULEX"></a><strong>ZRANGEBULEX</strong></h3><ul><li><p>按序返回指定成员区间的成员</p></li><li><p>区间成员的分数必须相同 </p></li><li><p>不要在分数不一致的SortSet集合中去使用 ZRANGEBYLEX 指令,因为获取的结果并不准确。</p></li><li><p>可以使用 “-“ 和 “+” 表示得分最小值和最大值</p></li><li><p>成员字符串作为二进制数组的字节数进行比较。默认是以ASCII字符集的顺序进行排列。</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">zadd zset 0 a 0 aa 0 abc 0 apple 0 b 0 c 0 d 0 d1 0 dd 0 dobble 0 z 0 z1<br>ZRANGEBYLEX zset - +<br><br>ZRANGEBYLEX zset - + limit 0 3  # 其中的0是结果的其实位置（offset） 3是结果的数量（count）<br><br>ZRANGEBULEX zset [aa [c<br><br>ZRANGEBULEX zset [aa (c<br></code></pre></td></tr></table></figure><h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ul><li>姓名排序</li></ul>  <img src="https://www.helloimg.com/images/2023/09/13/onxM6Y.png" alt="zrangebylex" border="0"><ul><li><p>电话号码排序</p><p>  <a href="https://www.helloimg.com/image/onx9Qg"><img src="https://www.helloimg.com/images/2023/09/13/onx9Qg.png" alt="onx9Qg.png"></a></p></li></ul></li></ul><h2 id="go-redis的基本使用"><a href="#go-redis的基本使用" class="headerlink" title="go-redis的基本使用"></a>go-redis的基本使用</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">go get github.com/go-redis/redis/v8<br></code></pre></td></tr></table></figure><h3 id="连接local-redis"><a href="#连接local-redis" class="headerlink" title="连接local  redis"></a>连接local  redis</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">doCommand</span><span class="hljs-params">()</span></span> &#123;<br>rdb := redis.NewClient(&amp;redis.Options&#123;<br>Addr:     <span class="hljs-string">&quot;localhost:6379&quot;</span>,<br>Password: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">// 密码</span><br>DB:       <span class="hljs-number">0</span>,  <span class="hljs-comment">// 数据库</span><br>PoolSize: <span class="hljs-number">20</span>, <span class="hljs-comment">// 连接池大小</span><br>&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="使用基本的go-redis指令"><a href="#使用基本的go-redis指令" class="headerlink" title="使用基本的go-redis指令"></a>使用基本的go-redis指令</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go">ctx, cancel := context.WithTimeout(context.Background(), time.Second)<br><span class="hljs-keyword">defer</span> cancel()<br><br>val, err := rdb.Get(ctx, <span class="hljs-string">&quot;key&quot;</span>).Result()<br>fmt.Println(val, err)<br><br>cmder := rdb.Get(ctx, <span class="hljs-string">&quot;key&quot;</span>)<br>val = cmder.Val()<br>err = cmder.Err()<br>fmt.Println(val, err)<br><br>err = rdb.Set(ctx, <span class="hljs-string">&quot;key1&quot;</span>, <span class="hljs-string">&quot;val1&quot;</span>, time.Hour).Err()<br><br>val = rdb.Get(ctx, <span class="hljs-string">&quot;key1&quot;</span>).Val()<br>fmt.Println(val, err)<br><br></code></pre></td></tr></table></figure><h3 id="go-redis中提供了redis-Nil-的错误来表示不存在的错误"><a href="#go-redis中提供了redis-Nil-的错误来表示不存在的错误" class="headerlink" title="go-redis中提供了redis.Nil 的错误来表示不存在的错误"></a>go-redis中提供了redis.Nil 的错误来表示不存在的错误</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go">rdb := redis.NewClient(&amp;redis.Options&#123;<br>Addr:     <span class="hljs-string">&quot;localhost:6379&quot;</span>,<br>Password: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">// 密码</span><br>DB:       <span class="hljs-number">0</span>,  <span class="hljs-comment">// 数据库</span><br>PoolSize: <span class="hljs-number">20</span>, <span class="hljs-comment">// 连接池大小</span><br>&#125;)<br>ctx, cancel := context.WithTimeout(context.Background(), time.Second)<br><span class="hljs-keyword">defer</span> cancel()<br><br>val, err := rdb.Get(ctx, <span class="hljs-string">&quot;key&quot;</span>).Result()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">if</span> errors.Is(err, redis.Nil) &#123;<br>fmt.Printf(<span class="hljs-string">&quot;redis.Nil&quot;</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br>fmt.Println(err)<br><span class="hljs-keyword">return</span><br>&#125;<br>fmt.Println(val, err)<br></code></pre></td></tr></table></figure><h3 id="使用-Client-Do-来实现任意redis指令"><a href="#使用-Client-Do-来实现任意redis指令" class="headerlink" title="使用 Client.Do 来实现任意redis指令"></a>使用 Client.Do 来实现任意redis指令</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go">rdb := redis.NewClient(&amp;redis.Options&#123;<br>Addr:     <span class="hljs-string">&quot;localhost:6379&quot;</span>,<br>Password: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">// 密码</span><br>DB:       <span class="hljs-number">0</span>,  <span class="hljs-comment">// 数据库</span><br>PoolSize: <span class="hljs-number">20</span>, <span class="hljs-comment">// 连接池大小</span><br>&#125;)<br>ctx, cancel := context.WithTimeout(context.Background(), time.Second)<br><span class="hljs-keyword">defer</span> cancel()<br><br>err := rdb.Do(ctx, <span class="hljs-string">&quot;set&quot;</span>, <span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-string">&quot;val2&quot;</span>, <span class="hljs-string">&quot;EX&quot;</span>, <span class="hljs-number">3600</span>).Err()<br>fmt.Println(err)<br><br>val, err := rdb.Do(ctx, <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;key2&quot;</span>).Result()<br>fmt.Println(val, err)<br></code></pre></td></tr></table></figure><h3 id="go-redis-ZSet-的使用"><a href="#go-redis-ZSet-的使用" class="headerlink" title="go-redis ZSet 的使用"></a>go-redis ZSet 的使用</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs go">rdb := redis.NewClient(&amp;redis.Options&#123;<br>Addr:     <span class="hljs-string">&quot;localhost:6379&quot;</span>,<br>Password: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">// 密码</span><br>DB:       <span class="hljs-number">0</span>,  <span class="hljs-comment">// 数据库</span><br>PoolSize: <span class="hljs-number">20</span>, <span class="hljs-comment">// 连接池大小</span><br>&#125;)<br>ctx, cancel := context.WithTimeout(context.Background(), time.Second)<br><span class="hljs-keyword">defer</span> cancel()<br><br>zsetKey := <span class="hljs-string">&quot;scores_rank&quot;</span><br><br>rank := []*redis.Z&#123;<br>&#123;Score: <span class="hljs-number">90.0</span>, Member: <span class="hljs-string">&quot;Alice&quot;</span>&#125;,<br>&#123;Score: <span class="hljs-number">90.1</span>, Member: <span class="hljs-string">&quot;Bob&quot;</span>&#125;,<br>&#123;Score: <span class="hljs-number">80.2</span>, Member: <span class="hljs-string">&quot;Cick&quot;</span>&#125;,<br>&#123;Score: <span class="hljs-number">89.2</span>, Member: <span class="hljs-string">&quot;David&quot;</span>&#125;,<br>&#123;Score: <span class="hljs-number">99.1</span>, Member: <span class="hljs-string">&quot;Eric&quot;</span>&#125;,<br>&#123;Score: <span class="hljs-number">78.1</span>, Member: <span class="hljs-string">&quot;Frank&quot;</span>&#125;,<br>&#125;<br><span class="hljs-keyword">if</span> err := rdb.ZAdd(ctx, zsetKey, rank...).Err(); err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;zadd failed&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;zadd success&quot;</span>)<br><br>newscore, err := rdb.ZIncrBy(ctx, zsetKey, <span class="hljs-number">-10</span>, <span class="hljs-string">&quot;Frank&quot;</span>).Result()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;zincrby failed&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;Frank&#x27;s score is %f\n&quot;</span>, newscore)<br><br>res := rdb.ZRevRangeWithScores(ctx, zsetKey, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>).Val()<br>fmt.Println(<span class="hljs-string">&quot;ZRevRangeWithScores&#x27;s res :&quot;</span>, res)<br><br><span class="hljs-keyword">for</span> _, z := <span class="hljs-keyword">range</span> res &#123;<br>fmt.Println(z)<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="Redis-Pipeline"><a href="#Redis-Pipeline" class="headerlink" title="Redis Pipeline"></a>Redis Pipeline</h3><ul><li><p>Pipeline  将发送的命令一次性打包发给Redis服务器执行，从而减少了RTT时延</p></li><li><p>Redis服务器会按照添加命令的顺序依次执行它们</p></li><li><p>Pipeline 不适合在这种情况下使用：单个命令可能需要等待前一个命令的结果，或者需要保证命令的顺序性</p></li></ul><h4 id="rdb-Pipeline"><a href="#rdb-Pipeline" class="headerlink" title="rdb.Pipeline()"></a>rdb.Pipeline()</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go">pipe := rdb.Pipeline()<br><br>incr := pipe.Incr(ctx, <span class="hljs-string">&quot;pipeline_counter&quot;</span>)<br>pipe.Expire(ctx, <span class="hljs-string">&quot;pipeline_counter&quot;</span>, time.Hour)<br>Get := pipe.Get(ctx, <span class="hljs-string">&quot;pipe_test1&quot;</span>)<br>_, err := pipe.Exec(ctx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><br><span class="hljs-comment">// 在执行pipe.Exec之后才能获取到结果</span><br>fmt.Println(incr.Val())<br>fmt.Println(Get.Val())<br></code></pre></td></tr></table></figure><h4 id="rdb-Pipelined"><a href="#rdb-Pipelined" class="headerlink" title="rdb.Pipelined()"></a>rdb.Pipelined()</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//set</span><br>cmds, err := rdb.Pipelined(ctx, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(pipe redis.Pipeliner)</span></span> <span class="hljs-type">error</span> &#123;<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++ &#123;<br>pipe.Set(ctx, fmt.Sprintf(<span class="hljs-string">&quot;key%d&quot;</span>, i), fmt.Sprintf(<span class="hljs-string">&quot;key%d&quot;</span>, i), <span class="hljs-number">0</span>)<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-comment">/*for _, cmd := range cmds &#123;</span><br><span class="hljs-comment">fmt.Println(cmd.(*redis.StringCmd).Val())</span><br><span class="hljs-comment">&#125;*/</span><br><span class="hljs-comment">//get</span><br>cmds, err = rdb.Pipelined(ctx, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(pipe redis.Pipeliner)</span></span> <span class="hljs-type">error</span> &#123;<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++ &#123;<br>pipe.Get(ctx, fmt.Sprintf(<span class="hljs-string">&quot;key%d&quot;</span>, i))<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-keyword">for</span> _, cmd := <span class="hljs-keyword">range</span> cmds &#123;<br>fmt.Println(cmd.(*redis.StringCmd).Val())<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="go-redis-事务"><a href="#go-redis-事务" class="headerlink" title="go-redis 事务"></a>go-redis 事务</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//TxPipelineDemo</span><br>pipe := rdb.TxPipeline()<br>incr := pipe.Incr(ctx, <span class="hljs-string">&quot;tx_pipeline_counter&quot;</span>)<br>pipe.Expire(ctx, <span class="hljs-string">&quot;tx_pipeline_counter&quot;</span>, time.Hour)<br>_, err := pipe.Exec(ctx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(err)<br><span class="hljs-keyword">return</span><br>&#125;<br>fmt.Println(incr.Val())<br><br><span class="hljs-comment">//TxPipelined demo TxPipelined 自动执行 Exec</span><br><span class="hljs-keyword">var</span> incr2 *redis.IntCmd<br>_, err = rdb.TxPipelined(ctx, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(pipe redis.Pipeliner)</span></span> <span class="hljs-type">error</span> &#123;<br>incr2 = pipe.Incr(ctx, <span class="hljs-string">&quot;tx_pipeline_counter&quot;</span>)<br>pipe.Expire(ctx, <span class="hljs-string">&quot;tx_pipeline_counter&quot;</span>, time.Hour)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;)<br>fmt.Println(incr2.Val(), err)<br><span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure><p>等价指令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">MULTI<br>INCR pipeline_counter<br>EXPIRE pipeline_counts 3600<br>EXEC<br></code></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="http://www.redis.cn/commands.html">Redis命令中心（Redis commands） – Redis中国用户组（CRUG）</a></li><li><a href="https://pkg.go.dev/github.com/go-redis/redis">redis package - github.com&#x2F;go-redis&#x2F;redis - Go Packages</a></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>grpc初探</title>
    <link href="/2023/09/11/grpc%E5%88%9D%E6%8E%A2/"/>
    <url>/2023/09/11/grpc%E5%88%9D%E6%8E%A2/</url>
    
    <content type="html"><![CDATA[<h2 id="什么是rpc"><a href="#什么是rpc" class="headerlink" title="什么是rpc"></a>什么是rpc</h2><p>RPC（Remote Procedure Call，远程过程调用）是一种计算机编程模型和协议，允许一个程序在另一个地址空间（通常是远程计算机上）执行函数或过程调用，就像调用本地函数一样。RPC 的目标是使分布式系统中的不同组件能够相互通信和协作，而不必手动编写复杂的网络通信代码。(chatGPT解释)</p><h2 id="是什么grpc"><a href="#是什么grpc" class="headerlink" title="是什么grpc"></a>是什么grpc</h2><p>gRPC（gRPC Remote Procedure Call）是一种高性能、跨语言的远程过程调用（RPC）框架，由Google开发并开源。它建立在HTTP&#x2F;2协议上，使用Protocol Buffers（protobuf）作为接口定义语言（IDL），支持多种编程语言。gRPC的目标是使分布式系统之间的通信更加高效、可靠和易于扩展。(chatGPT解释)</p><h2 id="protoc文件简要了解"><a href="#protoc文件简要了解" class="headerlink" title="protoc文件简要了解"></a>protoc文件简要了解</h2><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">syntax=<span class="hljs-string">&quot;proto3&quot;</span>; <span class="hljs-comment">//指定版本号</span><br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">SearchReqeust</span> &#123;<br><span class="hljs-type">string</span> KeyWord=<span class="hljs-number">1</span>;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231004144526377.png" alt="image-20231004144526377"></p><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20231004151742178.png" alt="image-20231004151742178"></p><h2 id="Hello-world-Demo"><a href="#Hello-world-Demo" class="headerlink" title="Hello world  Demo"></a>Hello world  Demo</h2><h3 id="编写-proto文件"><a href="#编写-proto文件" class="headerlink" title="编写 proto文件"></a>编写 proto文件</h3><h4 id="Server端"><a href="#Server端" class="headerlink" title="Server端"></a>Server端</h4><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<br><br><span class="hljs-keyword">option</span> go_package =<span class="hljs-string">&quot;server/pb&quot;</span>;<span class="hljs-comment">// 项目中import 导入生成的Go代码的名称 </span><br><br><span class="hljs-keyword">package</span> pb; <span class="hljs-comment">// proto文件模块</span><br><br><span class="hljs-keyword">service </span><span class="hljs-title class_">Greeter</span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">rpc</span> SayHello (HelloRequest) <span class="hljs-keyword">returns</span> (HelloResponse)</span>;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">HelloRequest</span>&#123;<br>  <span class="hljs-type">string</span>  name =<span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">HelloResponse</span>&#123;<br>  <span class="hljs-type">string</span>  reply=<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Client-端"><a href="#Client-端" class="headerlink" title="Client 端"></a>Client 端</h4><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<br><br><span class="hljs-keyword">option</span> go_package =<span class="hljs-string">&quot;client/pb&quot;</span>;<br><br><span class="hljs-keyword">package</span> pb;<br><br><span class="hljs-keyword">service </span><span class="hljs-title class_">Greeter</span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">rpc</span> SayHello (HelloRequest) <span class="hljs-keyword">returns</span> (HelloResponse)</span>;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">HelloRequest</span>&#123;<br>  <span class="hljs-type">string</span>  name =<span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">HelloResponse</span>&#123;<br>  <span class="hljs-type">string</span>  reply=<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="执行-proto文件"><a href="#执行-proto文件" class="headerlink" title="执行 proto文件"></a>执行 proto文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">protoc --go_out=. --go_opt=paths=source_relative \<br>--go-grpc_out=. --go-grpc_opt=paths=source_relative \<br>pb/hello.proto<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">protoc --proto_path=pb --go_out=pb --go_opt=paths=source_relative \<br>--go-grpc_out=pb --go-grpc_opt=paths=source_relative \<br>hello.proto<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">protoc -I=pb --go_out=pb --go_opt=paths=source_relative \<br>--go-grpc_out=pb --go-grpc_opt=paths=source_relative \<br>hello.proto<br></code></pre></td></tr></table></figure><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-comment">--I=pb 指定protoc_path </span><br><span class="hljs-comment">--go_out 指定pb.go输出文件位置</span><br><span class="hljs-comment">--go-grpc_out 指定grpc代码的位置</span><br><br></code></pre></td></tr></table></figure><h3 id="编写-逻辑代码"><a href="#编写-逻辑代码" class="headerlink" title="编写 逻辑代码"></a>编写 逻辑代码</h3><h4 id="Server端-1"><a href="#Server端-1" class="headerlink" title="Server端"></a>Server端</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;microService_Learning/grpc_demo/server/pb&quot;</span><br><span class="hljs-string">&quot;net&quot;</span><br><br><span class="hljs-string">&quot;google.golang.org/grpc&quot;</span><br>)<br><br><span class="hljs-comment">// hello server</span><br><br><span class="hljs-keyword">type</span> server <span class="hljs-keyword">struct</span> &#123;<br>pb.UnimplementedGreeterServer<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *server)</span></span> SayHello(ctx context.Context, request *pb.HelloRequest) (*pb.HelloResponse, <span class="hljs-type">error</span>) &#123;<br><span class="hljs-keyword">return</span> &amp;pb.HelloResponse&#123;Reply: <span class="hljs-string">&quot;Hello&quot;</span> + request.Name&#125;, <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>listener, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;:9091&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;net.Listen failed,err:%v\n&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>s := grpc.NewServer()<br>pb.RegisterGreeterServer(s, &amp;server&#123;&#125;)<br><span class="hljs-keyword">if</span> err = s.Serve(listener); err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;s.Serve failed,err:%v\n&quot;</span>, err)<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="Client端"><a href="#Client端" class="headerlink" title="Client端"></a>Client端</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//server/main.go</span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;flag&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;microService_Learning/grpc_demo/server/pb&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br><span class="hljs-string">&quot;google.golang.org/grpc/credentials/insecure&quot;</span><br><br><span class="hljs-string">&quot;google.golang.org/grpc&quot;</span><br>)<br><br><span class="hljs-comment">// hello_client</span><br><br><span class="hljs-keyword">const</span> (<br>defaultName = <span class="hljs-string">&quot;world&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> (<br><span class="hljs-comment">// 注意 flag.String 返回的是 *string</span><br>addr = flag.String(<span class="hljs-string">&quot;addr&quot;</span>, <span class="hljs-string">&quot;127.0.0.1:9092&quot;</span>, <span class="hljs-string">&quot;the address to connect to&quot;</span>)<br>name = flag.String(<span class="hljs-string">&quot;name&quot;</span>, defaultName, <span class="hljs-string">&quot;Name to greet&quot;</span>)<br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>flag.Parse()<br><span class="hljs-comment">// 连接到server端，此处禁用安全传输</span><br><span class="hljs-comment">//conn, err := grpc.Dial(*addr, grpc.WithInsecure())</span><br>conn, err := grpc.Dial(*addr, grpc.WithTransportCredentials(insecure.NewCredentials()))<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;grpc.Dail failed,err:%v\n&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> conn.Close()<br><br><span class="hljs-comment">//执行rpc调用 并打印返回相应的值</span><br>client := pb.NewGreeterClient(conn)<br>ctx, cancel := context.WithTimeout(context.Background(), time.Millisecond*<span class="hljs-number">3</span>)<br><span class="hljs-keyword">defer</span> cancel()<br>r, err := client.SayHello(ctx, &amp;pb.HelloRequest&#123;Name: *name&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;counld not greet :%v\n&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>log.Printf(<span class="hljs-string">&quot;Greeting :,%s&quot;</span>, r.GetReply())<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Add-Demo"><a href="#Add-Demo" class="headerlink" title="Add Demo"></a>Add Demo</h2><h3 id="server端-proto-文件"><a href="#server端-proto-文件" class="headerlink" title="server端  proto 文件"></a>server端  proto 文件</h3><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-comment">//path: add_server/pb/add.proto</span><br>syntax=<span class="hljs-string">&quot;proto3&quot;</span>;<br><br><span class="hljs-keyword">package</span> add_sever;<br><br><span class="hljs-keyword">option</span> go_package =<span class="hljs-string">&quot;add_server/pb&quot;</span>;<br><br><span class="hljs-keyword">service </span><span class="hljs-title class_">Add</span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">rpc</span> CalcService(AddRequest) <span class="hljs-keyword">returns</span> (AddResponse)</span>;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">AddRequest</span>&#123;<br>  <span class="hljs-type">int64</span> x=<span class="hljs-number">1</span>;<br>  <span class="hljs-type">int64</span> y=<span class="hljs-number">2</span>;<br>&#125;<br><br><span class="hljs-keyword">message  </span><span class="hljs-title class_">AddResponse</span>&#123;<br>  <span class="hljs-type">int64</span>  res=<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="server端具体逻辑代码"><a href="#server端具体逻辑代码" class="headerlink" title="server端具体逻辑代码"></a>server端具体逻辑代码</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// path: add_server/main.go</span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;add_server/pb&quot;</span><br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><br><span class="hljs-string">&quot;net&quot;</span><br><br><span class="hljs-string">&quot;google.golang.org/grpc&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> server <span class="hljs-keyword">struct</span> &#123;<br>pb.UnimplementedAddServer<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *server)</span></span> CalcService(ctx context.Context, in *pb.AddRequest) (*pb.AddResponse, <span class="hljs-type">error</span>) &#123;<br>sum := <span class="hljs-type">int64</span>(in.GetX()) + <span class="hljs-type">int64</span>(in.GetY())<br><span class="hljs-keyword">return</span> &amp;pb.AddResponse&#123;Res: sum&#125;, <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>listener, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;:3000&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;net.Listen failed,err:%v&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>s := grpc.NewServer()<br>pb.RegisterAddServer(s, &amp;server&#123;&#125;)<br><span class="hljs-keyword">if</span> err = s.Serve(listener); err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;s.Serve failed,err:%v&quot;</span>, err)<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="client端-proto-文件"><a href="#client端-proto-文件" class="headerlink" title="client端  proto 文件"></a>client端  proto 文件</h3><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-comment">// path: add_client/pb/add.proto</span><br>syntax=<span class="hljs-string">&quot;proto3&quot;</span>;<br><br><span class="hljs-keyword">package</span> add_sever;<br><br><span class="hljs-keyword">option</span> go_package =<span class="hljs-string">&quot;add_client/pb&quot;</span>;<br><br><span class="hljs-keyword">service </span><span class="hljs-title class_">Add</span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">rpc</span> CalcService(AddRequest) <span class="hljs-keyword">returns</span> (AddResponse)</span>;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">AddRequest</span>&#123;<br>  <span class="hljs-type">int64</span> x=<span class="hljs-number">1</span>;<br>  <span class="hljs-type">int64</span> y=<span class="hljs-number">2</span>;<br>&#125;<br><br><span class="hljs-keyword">message  </span><span class="hljs-title class_">AddResponse</span>&#123;<br>  <span class="hljs-type">int64</span>  res=<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="client端具体逻辑代码"><a href="#client端具体逻辑代码" class="headerlink" title="client端具体逻辑代码"></a>client端具体逻辑代码</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// path: add_client/main.go</span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;add_client/pb&quot;</span><br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;flag&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br><span class="hljs-string">&quot;google.golang.org/grpc&quot;</span><br><span class="hljs-string">&quot;google.golang.org/grpc/credentials/insecure&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> (<br>x = flag.Int(<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&quot;x的值&quot;</span>)<br>y = flag.Int(<span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-number">110</span>, <span class="hljs-string">&quot;x的值&quot;</span>)<br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>flag.Parse()<br><span class="hljs-comment">//建立连接</span><br>conn, err := grpc.Dial(<span class="hljs-string">&quot;127.0.0.1:3000&quot;</span>, grpc.WithTransportCredentials(insecure.NewCredentials()))<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;grpc.Dial failed,err:%v&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> conn.Close()<br><br><span class="hljs-comment">//创建 rpc client端</span><br>client := pb.NewAddClient(conn)<br>ctx, cacel := context.WithTimeout(context.Background(), time.Second)<br><span class="hljs-keyword">defer</span> cacel()<br>resp, err := client.CalcService(ctx, &amp;pb.AddRequest&#123;<br>X: <span class="hljs-type">int64</span>(*x),<br>Y: <span class="hljs-type">int64</span>(*y),<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;client.CalcService failed,err:%v&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>log.Printf(<span class="hljs-string">&quot;res:%v&quot;</span>, resp.GetRes())<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>参考</strong></p><ul><li><a href="https://www.liwenzhou.com/posts/Go/gRPC/#autoid-0-3-4">gRPC教程 | 李文周的博客 (liwenzhou.com)</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>grpc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【Golang 学习路线总结】</title>
    <link href="/2023/09/09/%E3%80%90Golang-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF%E6%80%BB%E7%BB%93%E3%80%91/"/>
    <url>/2023/09/09/%E3%80%90Golang-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF%E6%80%BB%E7%BB%93%E3%80%91/</url>
    
    <content type="html"><![CDATA[<ul><li>Golang设计模式 <a href="https://www.bilibili.com/video/BV1Eg411m7rV/?spm_id_from=333.999.0.0&vd_source=7e55f4c87cf718e9cce051dc48d89bb7">Easy搞定Golang设计模式(Go语言设计模式，如此简单)_哔哩哔哩_bilibili</a></li><li>B+树 <a href="https://www.bilibili.com/video/BV1kT411N7it/?spm_id_from=333.999.0.0&vd_source=7e55f4c87cf718e9cce051dc48d89bb7">B+树,B-link树,LSM树…一个视频带你了解常用存储引擎数据结构（中）_哔哩哔哩_bilibili</a></li><li>TCP IP 八股 <a href="https://www.bilibili.com/video/BV1Mp4y1x7eX/?spm_id_from=pageDriver&vd_source=7e55f4c87cf718e9cce051dc48d89bb7">tcp&#x2F;ip协议第10讲：tcp四次挥手以及wireshark抓包验证_哔哩哔哩_bilibili</a></li><li>Kubernetes <a href="https://www.bilibili.com/video/BV1MT411x7GH/?spm_id_from=333.999.0.0&vd_source=7e55f4c87cf718e9cce051dc48d89bb7">完整版Kubernetes（K8S）全套入门+微服务实战项目，带你一站式深入掌握K8S核心能力_哔哩哔哩_bilibili</a></li><li>开发效率提升神器 <strong>air</strong> <a href="https://github.com/cosmtrek/air/tree/master">cosmtrek&#x2F;air: ☁️ Live reload for Go apps (github.com)</a></li><li><a href="https://www.yuque.com/aceld/lfhu8y/rg6nsf">Easy搞定Golang设计模式 (yuque.com)</a></li><li><a href="https://www.bookstack.cn/read/GoExpertProgramming/chapter01-1.1-chan.md">常见数据结构实现原理 GO专家编程》</a></li><li><a href="https://www.bilibili.com/video/BV1cr4y1s7H4/?spm_id_from=333.337.search-card.all.click&vd_source=7e55f4c87cf718e9cce051dc48d89bb7">【Go项目实战】基于Go-zero、Xorm的网盘系统_哔哩哔哩_bilibili</a></li><li><a href="https://www.bilibili.com/video/BV1BP4y1H7gV/?spm_id_from=333.337.search-card.all.click&vd_source=7e55f4c87cf718e9cce051dc48d89bb7">【Go语言实战】Gin+WebSocket构建IM即时聊天Demo_哔哩哔哩_bilibili</a></li><li><a href="https://www.bilibili.com/video/BV1Df4y1C7o5/?spm_id_from=333.337.search-card.all.click&vd_source=7e55f4c87cf718e9cce051dc48d89bb7">【Go语言战实战】日志收集项目开发（完整版）_哔哩哔哩_bilibili</a></li><li><a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html">SSL&#x2F;TLS协议运行机制的概述 - 阮一峰的网络日志 (ruanyifeng.com)</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>总结</category>
      
      <category>golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>学习路线记录</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>傻蛋速成python</title>
    <link href="/2023/09/07/%E5%82%BB%E8%9B%8B%E9%80%9F%E6%88%90python/"/>
    <url>/2023/09/07/%E5%82%BB%E8%9B%8B%E9%80%9F%E6%88%90python/</url>
    
    <content type="html"><![CDATA[<p>格式化 </p><ul><li></li></ul><p>%</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">str</span>=<span class="hljs-string">&quot;%s is %d years old&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">str</span> % (<span class="hljs-string">&quot;yst&quot;</span>,<span class="hljs-number">123</span>)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">&#x27;yst is 123 years old&#x27;</span><br></code></pre></td></tr></table></figure><p>format</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#123;:d&#125; + &#123;:d&#125; =&#123;:d&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">1</span>,<span class="hljs-number">21</span>,<span class="hljs-number">1</span>+<span class="hljs-number">21</span>)<br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-string">&#x27;&#123;1:d&#125; + &#123;0:d&#125; =&#123;2:d&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">1</span>,<span class="hljs-number">21</span>,<span class="hljs-number">1</span>+<span class="hljs-number">21</span>)<br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-string">&#x27;&#123;0:d&#125; + &#123;0:d&#125; + &#123;1:d&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">1</span>,<span class="hljs-number">21</span>)<br></code></pre></td></tr></table></figure><p>f</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">f `&#123;name&#125; <span class="hljs-keyword">is</span> &#123;age&#125; years old`<br></code></pre></td></tr></table></figure><p>结构控制 </p><p>for语句</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py">scores=[<span class="hljs-number">90</span>,<span class="hljs-number">45</span>,<span class="hljs-number">85</span>,<span class="hljs-number">76</span>,<span class="hljs-number">89</span>]<br><br><span class="hljs-keyword">for</span> score <span class="hljs-keyword">in</span> scores:<br>    <span class="hljs-keyword">if</span> score &gt;=<span class="hljs-number">60</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;PASS&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Failed&quot;</span>)       <br></code></pre></td></tr></table></figure><p>in range</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">10</span>):<br>    <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py">scores=[<span class="hljs-number">90</span>,<span class="hljs-number">45</span>,<span class="hljs-number">85</span>,<span class="hljs-number">76</span>,<span class="hljs-number">89</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-built_in">len</span>(scores)):<br>    <span class="hljs-built_in">print</span>(scores[i])<br><br></code></pre></td></tr></table></figure><p>in enumerate</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py">scores = [<span class="hljs-number">90</span>, <span class="hljs-number">45</span>, <span class="hljs-number">85</span>, <span class="hljs-number">76</span>, <span class="hljs-number">89</span>, <span class="hljs-number">900</span>]<br><br><span class="hljs-keyword">for</span> i, score <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(scores, <span class="hljs-number">1</span>):<br>    <span class="hljs-built_in">print</span>(i, score)<br><br><br></code></pre></td></tr></table></figure><p>in zip</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py">scores = [<span class="hljs-number">90</span>, <span class="hljs-number">45</span>, <span class="hljs-number">85</span>, <span class="hljs-number">76</span>, <span class="hljs-number">89</span>, <span class="hljs-number">900</span>]<br>names = [<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-string">&quot;G&quot;</span>]<br><br><span class="hljs-keyword">for</span> name, score <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(names, scores):<br>    <span class="hljs-built_in">print</span>(name, score)<br><br></code></pre></td></tr></table></figure><h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><p>hash仅支持 immutable的对象 str &#x2F;int &#x2F;bool&#x2F;float&#x2F;tuple</p><h2 id="func"><a href="#func" class="headerlink" title="func"></a>func</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">foobar</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;this is a python func&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name=<span class="hljs-string">&quot;Alice&quot;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;this is a comment&quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;hello <span class="hljs-subst">&#123;name&#125;</span>&#x27;</span>)<br><br><br>foobar()<br>greet()<br>greet(<span class="hljs-string">&quot;name&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, y</span>):<br>    res = x + y<br>    <span class="hljs-keyword">return</span> res<br><br><br>sum_res = add(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)<br></code></pre></td></tr></table></figure><p>闭包 函数作为返回值</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># 函数的闭包</span><br><span class="hljs-comment"># 一个函数A中定义了函数B，并且另函数B调用了函数A的参数，且返回函数B作为返回值</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">f2</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">f3</span>(<span class="hljs-params">y</span>):<br>        <span class="hljs-keyword">return</span> x + y<br><br>    <span class="hljs-keyword">return</span> f3<br><br><span class="hljs-built_in">print</span>(f2(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>))<br><br></code></pre></td></tr></table></figure><p>lambda表达式</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">3</span> * x ** <span class="hljs-number">2</span> + <span class="hljs-number">9</span> * x + <span class="hljs-number">10</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">diff</span>(<span class="hljs-params">x, func</span>):<br>    delta = <span class="hljs-number">1e-6</span><br>    <span class="hljs-keyword">return</span> (func(x + delta) - func(x)) / delta<br><br><br><span class="hljs-built_in">print</span>(diff(<span class="hljs-number">2</span>, f))<br><br><span class="hljs-built_in">print</span>(diff(<span class="hljs-number">1</span>, <span class="hljs-keyword">lambda</span> x: <span class="hljs-number">2</span> * x ** <span class="hljs-number">3</span> + <span class="hljs-number">9</span> * x + <span class="hljs-number">9</span>))<br><br></code></pre></td></tr></table></figure><p><code>Chatgpt对于 python中函数是一等公民的解释</code></p><p>在编程语言中，”一等公民”（First-Class Citizen）是一个概念，用来描述对某种特性（通常是数据类型）的支持程度。如果一种编程语言将某个特性视为一等公民，那么该特性就会享有与其他标准数据类型相同的权利和特性。在Python中，函数被视为一等公民，这意味着函数在语言中具有特殊的地位和权利：</p><p>以下是Python中函数被称为一等公民的原因和表现：</p><ol><li><p><strong>可以赋值给变量</strong>：您可以将函数赋值给变量，然后通过该变量调用函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Hello, <span class="hljs-subst">&#123;name&#125;</span>!&quot;</span>)<br><br>my_function = greet  <span class="hljs-comment"># 将函数赋值给变量</span><br>my_function(<span class="hljs-string">&quot;Alice&quot;</span>)  <span class="hljs-comment"># 通过变量调用函数</span><br></code></pre></td></tr></table></figure></li><li><p><strong>可以作为参数传递</strong>：您可以将函数作为参数传递给其他函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">apply</span>(<span class="hljs-params">func, x</span>):<br>    <span class="hljs-keyword">return</span> func(x)<br><br>result = apply(square, <span class="hljs-number">5</span>)  <span class="hljs-comment"># 将函数 square 作为参数传递给 apply 函数</span><br></code></pre></td></tr></table></figure><p>在上述示例中，<code>apply</code> 函数接受一个函数作为参数，然后将该函数应用于给定的参数 <code>x</code>。</p></li><li><p><strong>可以作为返回值</strong>：您可以从一个函数中返回另一个函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">multiplier</span>(<span class="hljs-params">factor</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">x</span>):<br>        <span class="hljs-keyword">return</span> x * factor<br>    <span class="hljs-keyword">return</span> multiply<br><br>double = multiplier(<span class="hljs-number">2</span>)  <span class="hljs-comment"># 返回一个函数</span><br>result = double(<span class="hljs-number">5</span>)  <span class="hljs-comment"># 调用返回的函数</span><br></code></pre></td></tr></table></figure><p>在上述示例中，<code>multiplier</code> 函数返回了另一个函数 <code>multiply</code>，并且可以通过 <code>double</code> 变量来调用返回的函数。</p></li><li><p><strong>可以存储在数据结构中</strong>：函数可以存储在列表、字典或其他数据结构中，以便在后续使用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">functions = [square, cube, add]<br>result = functions[<span class="hljs-number">0</span>](<span class="hljs-number">3</span>)  <span class="hljs-comment"># 从列表中获取函数并调用它</span><br></code></pre></td></tr></table></figure><p>上述示例中，<code>functions</code> 列表存储了不同的函数，可以根据需要选择并调用其中的一个。</p></li></ol><p>因此，Python中的函数被称为一等公民，因为它们具有与其他数据类型（如整数、字符串和列表）相同的权利和特性。这种特性使得Python非常适合于函数式编程范式，并允许编写更灵活和可复用的代码。函数作为一等公民的特性在编写高阶函数和实现回调机制等编程任务时非常有用。</p><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># 交换两个元素的值</span><br>x, y = <span class="hljs-number">30</span>, <span class="hljs-number">50</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x=%d,y=%d&#x27;</span> % (x, y))<br>t = x<br>x = y<br>y = x<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x=%d,y=%d&quot;</span> % (x, y))<br><br>x, y = <span class="hljs-number">30</span>, <span class="hljs-number">50</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x=%d,y=%d&quot;</span> % (x, y))<br>x, y = y, x<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x=%d y=%d&quot;</span> % (x, y))<br><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py">a, b, c, x = <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1.414</span><br>res = a * x ** <span class="hljs-number">3</span> + b * x ** <span class="hljs-number">2</span> + c<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;多项式的值为:<span class="hljs-subst">&#123;res:<span class="hljs-number">.2</span>f&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> sympy <span class="hljs-keyword">as</span> sp<br><br>x = sp.symbols(<span class="hljs-string">&#x27;x&#x27;</span>)<br><br>f = <span class="hljs-number">5</span> * x ** <span class="hljs-number">2</span> - <span class="hljs-number">4</span> * x - <span class="hljs-number">1</span><br><br>solution = sp.solve((f, x))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;方程的解为:<span class="hljs-subst">&#123;solution&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py">a, b, c, x, y, z = <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1.414</span>, <span class="hljs-number">1.732</span>, <span class="hljs-number">2.712</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;a=<span class="hljs-subst">&#123;a:&lt;<span class="hljs-number">7</span>&#125;</span> b=<span class="hljs-subst">&#123;b:&lt;<span class="hljs-number">7</span>&#125;</span> c=<span class="hljs-subst">&#123;c:&lt;<span class="hljs-number">7</span>&#125;</span>&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;x=<span class="hljs-subst">&#123;x:&lt;<span class="hljs-number">7.3</span>f&#125;</span> y=<span class="hljs-subst">&#123;y:&lt;<span class="hljs-number">7.3</span>f&#125;</span> z=<span class="hljs-subst">&#123;z:&lt;<span class="hljs-number">7.3</span>f&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py">num = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入一个三位的正整数&quot;</span>))<br><br>gewei = num % <span class="hljs-number">10</span><br>shiwei = (num // <span class="hljs-number">10</span>) % <span class="hljs-number">10</span><br>baiwei = num // <span class="hljs-number">100</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;百位数字:<span class="hljs-subst">&#123;baiwei&#125;</span>&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;十位数字<span class="hljs-subst">&#123;shiwei&#125;</span>&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;个位数字<span class="hljs-subst">&#123;gewei&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py">c = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入设施温度&quot;</span>))<br><br>f = (<span class="hljs-number">9</span> / <span class="hljs-number">5</span>) * c + <span class="hljs-number">32</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;华氏温度为:<span class="hljs-subst">&#123;f:<span class="hljs-number">.1</span>f&#125;</span>度&quot;</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py">result = math.exp(<span class="hljs-number">3.14</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;e 的3.14次方的结果是<span class="hljs-subst">&#123;result:<span class="hljs-number">.5</span>f&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># 输入三角形的三条边长</span><br>a = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入第一条边的长度：&quot;</span>))<br>b = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入第二条边的长度：&quot;</span>))<br>c = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入第三条边的长度：&quot;</span>))<br><br><span class="hljs-comment"># 计算三角形的半周长</span><br>s = (a + b + c) / <span class="hljs-number">2</span><br><br><span class="hljs-comment"># 计算三角形的面积</span><br>area = math.sqrt(s * (s - a) * (s - b) * (s - c))<br><br><span class="hljs-comment"># 打印结果</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;三角形的面积是：<span class="hljs-subst">&#123;area:<span class="hljs-number">.2</span>f&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py">radius = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入球的半径:&quot;</span>))<br><br>volume = (<span class="hljs-number">4</span> / <span class="hljs-number">3</span>) * math.pi * radius ** <span class="hljs-number">3</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;球的体积是:<span class="hljs-subst">&#123;volume:<span class="hljs-number">.1</span>f&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py">v1 = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;第一个数字&quot;</span>))<br><br>v2 = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;第二个数字&quot;</span>))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;平均值:<span class="hljs-subst">&#123;(v1 + v2) / <span class="hljs-number">2</span>:<span class="hljs-number">.2</span>f&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py">r = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;圆柱形的半径&quot;</span>))<br><br>h = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;圆柱体的高&quot;</span>))<br><br>res1 = <span class="hljs-number">2</span> * math.pi * (r ** <span class="hljs-number">2</span>) + <span class="hljs-number">2</span> * math.pi * r * h<br><br>res2 = math.pi * (r ** <span class="hljs-number">2</span>) * h<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;圆柱体的表面积:<span class="hljs-subst">&#123;res1:<span class="hljs-number">.2</span>f&#125;</span>&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;圆柱体的体积:<span class="hljs-subst">&#123;res2:<span class="hljs-number">.2</span>f&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python3</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker的基本使用</title>
    <link href="/2023/09/06/docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/09/06/docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> golang:alpine<br><br><span class="hljs-comment"># Set necessary environmet variables needed for our image</span><br><span class="hljs-keyword">ENV</span> GO111MODULE=on \<br>    CGO_ENABLED=<span class="hljs-number">0</span> \<br>    GOOS=linux \<br>    GOARCH=amd64<br><br><span class="hljs-comment"># Move to working directory /build</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /build</span><br><br><span class="hljs-comment"># Copy and download dependency using go mod</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> go.mod .</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> go.sum .</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> go mod download</span><br><br><span class="hljs-comment"># Copy the code into the container</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> . .</span><br><br><span class="hljs-comment"># Build the application</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> go build -o main .</span><br><br><span class="hljs-comment"># Move to /dist directory as the place for resulting binary folder</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /dist</span><br><br><span class="hljs-comment"># Copy binary from build to main folder</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">cp</span> /build/main .</span><br><br><span class="hljs-comment"># Export necessary port</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">3000</span><br><br><span class="hljs-comment"># Command to run when starting the container</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/dist/main&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>docker build . -t go-dock</p><p>docker run -p 3000:3000 go-dock</p><p>左边的 3000 是主机（你的计算机）上的端口号。<br>       右边的 3000 是Docker容器内部的端口号。</p><p>​</p><p>go mod tidy</p><p>go mod init [mod-name]</p>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>shell编程</title>
    <link href="/2023/09/02/shell%E7%BC%96%E7%A8%8B/"/>
    <url>/2023/09/02/shell%E7%BC%96%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p> <code>#!/bin/bash</code>。这是一个典型的Bash脚本的开头，指定了脚本要使用的解释器，即Bash。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment"># Author : Forrest</span><br><br><span class="hljs-built_in">pwd</span><br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">mkdir</span> testDir<br><br></code></pre></td></tr></table></figure><p><strong>添加执行权限</strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x filename<br></code></pre></td></tr></table></figure><p>用read命令来获取keyboard的输入，并将输入结果赋值给变量 The following script uses the <strong>read</strong> command which takes the input from the keyboard and assigns it as the value of the variable PERSON and finally prints it on STDOUT.</p><p>用$符号来获取变量的值 To access the value stored in a variable, prefix its name with the dollar sign (<strong>$</strong>)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment"># Author : Forrest</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;what is your name&quot;</span><br><span class="hljs-built_in">read</span> name<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello ,<span class="hljs-variable">$name</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;done&quot;</span><br></code></pre></td></tr></table></figure><h2 id="Using-Variables"><a href="#Using-Variables" class="headerlink" title="Using Variables"></a>Using Variables</h2><h4 id="Defining-Variables"><a href="#Defining-Variables" class="headerlink" title="Defining  Variables"></a>Defining  Variables</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">variable_name=variable_value<br><br>NAME=<span class="hljs-string">&quot;Forrest&quot;</span><br>NUMBER=123<br></code></pre></td></tr></table></figure><h4 id="Accessing-values"><a href="#Accessing-values" class="headerlink" title="Accessing values"></a>Accessing values</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">NAME=<span class="hljs-string">&quot;Forrest&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$NAME</span><br></code></pre></td></tr></table></figure><h4 id="Read-only-Variables"><a href="#Read-only-Variables" class="headerlink" title="Read-only Variables"></a>Read-only Variables</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">NAME=<span class="hljs-string">&quot;Forrest&quot;</span><br><span class="hljs-built_in">readonly</span> NAME<br>NAME=<span class="hljs-string">&quot;another name&quot;</span><br></code></pre></td></tr></table></figure><p>err: </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">-bash: NAME: <span class="hljs-built_in">readonly</span> variable<br></code></pre></td></tr></table></figure><p><code>readonly</code> 变量的只读属性是永久性的，不能在脚本中或shell会话中被修改或取消。Unsetting Variables</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">unset</span> vaiable_name<br></code></pre></td></tr></table></figure><p>Special Variables </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;what is your name&quot;</span><br><span class="hljs-built_in">read</span> name<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello ,<span class="hljs-variable">$name</span>&quot;</span><br><span class="hljs-comment"># special variable</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;current script pid: $$&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;filename : <span class="hljs-variable">$0</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;first parameter: <span class="hljs-variable">$1</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;second parameter :<span class="hljs-variable">$2</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;quoted values <span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;quoted values $*&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;total number of quoted  <span class="hljs-variable">$#</span>&quot;</span><br><br><span class="hljs-keyword">for</span> TOKEN <span class="hljs-keyword">in</span> $*<br><span class="hljs-keyword">do</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-variable">$TOKEN</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;exit status $?&quot;</span><br></code></pre></td></tr></table></figure><h2 id="Using-Shell-Arrays"><a href="#Using-Shell-Arrays" class="headerlink" title="Using Shell Arrays"></a>Using Shell Arrays</h2><p>查看shell是 ksh 还是bash</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$SHELL</span><br></code></pre></td></tr></table></figure><p><img src="C:\Users\Forrest\AppData\Roaming\Typora\typora-user-images\image-20230830201146754.png" alt="image-20230830201146754"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br>Arr[0]=<span class="hljs-string">&quot;0&quot;</span><br>Arr[1]=<span class="hljs-string">&quot;1&quot;</span><br>Arr[2]=<span class="hljs-string">&quot;2&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;first item <span class="hljs-variable">$&#123;Arr[0]&#125;</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;first method <span class="hljs-variable">$&#123;Arr[*]&#125;</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;second method <span class="hljs-variable">$&#123;Arr[@]&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><h2 id="Decision-Making"><a href="#Decision-Making" class="headerlink" title="Decision Making"></a>Decision Making</h2><h3 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">a=10<br>b=20<br><span class="hljs-keyword">if</span> [<span class="hljs-variable">$a</span>==<span class="hljs-variable">$b</span>]<br><span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a equlas b&quot;</span><br><span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a not equals b&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="if-elseif"><a href="#if-elseif" class="headerlink" title="if elseif"></a>if elseif</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br>a=10<br>b=20<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$a</span> == <span class="hljs-variable">$b</span> ]<br><span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a equals b&quot;</span><br><span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$a</span> -gt <span class="hljs-variable">$b</span> ]<br><span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a is greater than b&quot;</span><br><span class="hljs-keyword">elif</span>  [ <span class="hljs-variable">$a</span> -lt <span class="hljs-variable">$b</span> ]<br><span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a is less than b&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>​</p><h3 id="case-esac"><a href="#case-esac" class="headerlink" title="case .. esac"></a>case .. esac</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br>option=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;1&#125;</span>&quot;</span><br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$&#123;option&#125;</span> <span class="hljs-keyword">in</span><br>        -f) FILE=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;2&#125;</span>&quot;</span><br>                        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;File name is <span class="hljs-variable">$FILE</span>&quot;</span><br>                        ;;<br>        -d) DIR=<span class="hljs-variable">$&#123;2&#125;</span><br>                        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Dir name is <span class="hljs-variable">$DIR</span>&quot;</span><br>                        ;;<br>        *)<br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;`basename <span class="hljs-variable">$&#123;0&#125;</span> `:usage :[-f file] | [-d directory]&quot;</span><br>                <span class="hljs-built_in">exit</span> 1<br>                ;;<br><span class="hljs-keyword">esac</span><br></code></pre></td></tr></table></figure><h2 id="IO-Redirection"><a href="#IO-Redirection" class="headerlink" title="IO Redirection"></a>IO Redirection</h2><h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p><strong>who</strong> command which redirects the complete output of the command in the users file.</p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">who</span> &gt; <span class="hljs-built_in">users</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> line 1 &gt;  <span class="hljs-built_in">users</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> line 2 &gt;&gt; uses<br></code></pre></td></tr></table></figure><h2 id="eval"><a href="#eval" class="headerlink" title="eval"></a><strong>eval</strong></h2><p><code>eval</code> 是一个在Shell脚本中用于执行字符串作为命令的特殊命令。它会将传递给它的字符串作为Shell命令进行解释和执行。<code>eval</code> 常用于动态生成和执行命令，可以将字符串中的变量、表达式和命令进行求值和执行。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">x=5<br>y=3<br>operation=<span class="hljs-string">&quot;x+y&quot;</span><br>result=$(<span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;echo \$(( <span class="hljs-variable">$operation</span> ))&quot;</span>)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Result: <span class="hljs-variable">$result</span>&quot;</span><br><br></code></pre></td></tr></table></figure><h2 id="使用多行注释"><a href="#使用多行注释" class="headerlink" title="使用多行注释"></a>使用多行注释</h2><p>你可以使用 <code>:&lt;&lt;COMMENT</code> 和 <code>COMMENT</code> 来实现多行注释。例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">bashCopy code:&lt;&lt;<span class="hljs-string">COMMENT</span><br><span class="hljs-string">这是多行注释的内容。</span><br><span class="hljs-string">可以有多行。</span><br><span class="hljs-string">这里可以写注释。</span><br><span class="hljs-string">COMMENT</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;这是实际的代码。&quot;</span><br></code></pre></td></tr></table></figure><p>在上面的示例中，冒号 <code>:</code> 后面的 <code>&lt;&lt;COMMENT</code> 表示将会读取从 <code>COMMENT</code> 开始的多行文本，这部分文本会被当作注释而被忽略。当Shell执行脚本时，它会跳过这些注释内容。</p><h2 id="权限问题"><a href="#权限问题" class="headerlink" title="权限问题"></a>权限问题</h2><h3 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h3><p><strong>parameter :  + - &#x3D;</strong></p><p>+表示全局（User group other）添加某些权限</p><p>-表示全局（User Group Other） 删除某些权限</p><p>&#x3D;表示设置（User | Group | Other）的权限是什么</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chmod</span> o+wx testfile<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chmod</span> 743 testfile<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2023/08/01/hello-world/"/>
    <url>/2023/08/01/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
